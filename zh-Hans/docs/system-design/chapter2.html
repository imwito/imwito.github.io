<!doctype html>
<html lang="zh-Hans" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-system-design/chapter2" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.3">
<title data-rh="true">Chapter 2 | My Site</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://imwito.github.io/zh-Hans/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://imwito.github.io/zh-Hans/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://imwito.github.io/zh-Hans/docs/system-design/chapter2"><meta data-rh="true" name="docusaurus_locale" content="zh-Hans"><meta data-rh="true" name="docsearch:language" content="zh-Hans"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Chapter 2 | My Site"><meta data-rh="true" name="description" content="Databases and DBMS"><meta data-rh="true" property="og:description" content="Databases and DBMS"><link data-rh="true" rel="icon" href="/zh-Hans/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://imwito.github.io/zh-Hans/docs/system-design/chapter2"><link data-rh="true" rel="alternate" href="https://imwito.github.io/docs/system-design/chapter2" hreflang="en"><link data-rh="true" rel="alternate" href="https://imwito.github.io/zh-Hans/docs/system-design/chapter2" hreflang="zh-Hans"><link data-rh="true" rel="alternate" href="https://imwito.github.io/docs/system-design/chapter2" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/zh-Hans/blog/rss.xml" title="My Site RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/zh-Hans/blog/atom.xml" title="My Site Atom Feed">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.24/dist/katex.min.css" integrity="sha384-odtC+0UGzzFL/6PNoE8rX/SPcQDXBJ+uRepguP4QkPCm2LBxH3FA3y+fKSiJ+AmM" crossorigin="anonymous"><link rel="stylesheet" href="/zh-Hans/assets/css/styles.466a89db.css">
<link rel="preload" href="/zh-Hans/assets/js/runtime~main.c214fdea.js" as="script">
<link rel="preload" href="/zh-Hans/assets/js/main.c22237af.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="跳到主要内容"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">跳到主要内容</a></div><nav aria-label="主导航" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/zh-Hans/"><div class="navbar__logo"><img src="/zh-Hans/img/logo.svg" alt="My Site Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/zh-Hans/img/logo.svg" alt="My Site Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">My Site</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/zh-Hans/docs/intro">Tutorial</a><a class="navbar__item navbar__link" href="/zh-Hans/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/imwito/imwito.github.io" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>简体中文</a><ul class="dropdown__menu"><li><a href="/docs/system-design/chapter2" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="en">English</a></li><li><a href="/zh-Hans/docs/system-design/chapter2" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="zh-Hans">简体中文</a></li></ul></div><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="切换浅色/暗黑模式（当前为浅色模式）" aria-label="切换浅色/暗黑模式（当前为浅色模式）" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="文档侧边栏" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/zh-Hans/docs/intro">Tutorial Intro</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/zh-Hans/docs/category/system-design">System Design</a><button aria-label="打开/收起侧边栏菜单「System Design」" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-Hans/docs/system-design/intro">Intro</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-Hans/docs/system-design/chapter1">Chapter 1</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/zh-Hans/docs/system-design/chapter2">Chapter 2</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-Hans/docs/system-design/chapter3">Chapter 3</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-Hans/docs/system-design/chapter4">Chapter 4</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-Hans/docs/system-design/chapter5">Chapter 5</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/zh-Hans/docs/category/tutorial---basics">Tutorial - Basics</a><button aria-label="打开/收起侧边栏菜单「Tutorial - Basics」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/zh-Hans/docs/category/tutorial---extras">Tutorial - Extras</a><button aria-label="打开/收起侧边栏菜单「Tutorial - Extras」" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav><button type="button" title="收起侧边栏" aria-label="收起侧边栏" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="页面路径"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="主页面" class="breadcrumbs__link" href="/zh-Hans/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/zh-Hans/docs/category/system-design"><span itemprop="name">System Design</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Chapter 2</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">本页总览</button></div><div class="theme-doc-markdown markdown"><h1>Chapter 2</h1><h2 class="anchor anchorWithStickyNavbar_LWe7" id="databases-and-dbms">Databases and DBMS<a href="#databases-and-dbms" class="hash-link" aria-label="Databases and DBMS的直接链接" title="Databases and DBMS的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="what-is-a-database">What is a Database?<a href="#what-is-a-database" class="hash-link" aria-label="What is a Database?的直接链接" title="What is a Database?的直接链接">​</a></h3><p>A database is an organized collection of structured information, or data, typically stored electronically in a computer system. A database is usually controlled by a Database Management System (DBMS). Together, the data and the DBMS, along with the applications that are associated with them, are referred to as a database system, often shortened to just database.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="what-is-dbms">What is DBMS?<a href="#what-is-dbms" class="hash-link" aria-label="What is DBMS?的直接链接" title="What is DBMS?的直接链接">​</a></h3><p>A database typically requires a comprehensive database software program known as a Database Management System (DBMS). A DBMS serves as an interface between the database and its end-users or programs, allowing users to retrieve, update, and manage how the information is organized and optimized. A DBMS also facilitates oversight and control of databases, enabling a variety of administrative operations such as performance monitoring, tuning, and backup and recovery.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="components">Components<a href="#components" class="hash-link" aria-label="Components的直接链接" title="Components的直接链接">​</a></h3><p>Here are some common components found across different databases:</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="schema">Schema<a href="#schema" class="hash-link" aria-label="Schema的直接链接" title="Schema的直接链接">​</a></h4><p>The role of a schema is to define the shape of a data structure, and specify what kinds of data can go where. Schemas can be strictly enforced across the entire database, loosely enforced on part of the database, or they might not exist at all.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="table">Table<a href="#table" class="hash-link" aria-label="Table的直接链接" title="Table的直接链接">​</a></h4><p>Each table contains various columns just like in a spreadsheet. A table can have as meager as two columns and upwards of a hundred or more columns, depending upon the kind of information being put in the table.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="column">Column<a href="#column" class="hash-link" aria-label="Column的直接链接" title="Column的直接链接">​</a></h4><p>A column contains a set of data values of a particular type, one value for each row of the database. A column may contain text values, numbers, enums, timestamps, etc.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="row">Row<a href="#row" class="hash-link" aria-label="Row的直接链接" title="Row的直接链接">​</a></h4><p>Data in a table is recorded in rows. There can be thousands or millions of rows in a table having any particular information.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="types">Types<a href="#types" class="hash-link" aria-label="Types的直接链接" title="Types的直接链接">​</a></h3><p><img loading="lazy" src="https://raw.githubusercontent.com/karanpratapsingh/portfolio/master/public/static/courses/system-design/chapter-II/databases-and-dbms/database-types.png" alt="database-types" class="img_ev3q"></p><p>Below are different types of databases:</p><ul><li><strong><a href="https://karanpratapsingh.com/courses/system-design/sql-databases" target="_blank" rel="noopener noreferrer">SQL</a></strong></li><li><strong><a href="https://karanpratapsingh.com/courses/system-design/nosql-databases" target="_blank" rel="noopener noreferrer">NoSQL</a></strong><ul><li>Document</li><li>Key-value</li><li>Graph</li><li>Timeseries</li><li>Wide column</li><li>Multi-model</li></ul></li></ul><p>SQL and NoSQL databases are broad topics and will be discussed separately in <a href="https://karanpratapsingh.com/courses/system-design/sql-databases" target="_blank" rel="noopener noreferrer">SQL databases</a> and <a href="https://karanpratapsingh.com/courses/system-design/nosql-databases" target="_blank" rel="noopener noreferrer">NoSQL databases</a>. Learn how they compare to each other in <a href="https://karanpratapsingh.com/courses/system-design/sql-vs-nosql-databases" target="_blank" rel="noopener noreferrer">SQL vs NoSQL databases</a>.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="challenges">Challenges<a href="#challenges" class="hash-link" aria-label="Challenges的直接链接" title="Challenges的直接链接">​</a></h3><p>Some common challenges faced while running databases at scale:</p><ul><li><strong>Absorbing significant increases in data volume</strong>: The explosion of data coming in from sensors, connected machines, and dozens of other sources.</li><li><strong>Ensuring data security</strong>: Data breaches are happening everywhere these days, it&#x27;s more important than ever to ensure that data is secure but also easily accessible to users.</li><li><strong>Keeping up with demand</strong>: Companies need real-time access to their data to support timely decision-making and to take advantage of new opportunities.</li><li><strong>Managing and maintaining the database and infrastructure</strong>: As databases become more complex and data volumes grow, companies are faced with the expense of hiring additional talent to manage their databases.</li><li><strong>Removing limits on scalability</strong>: A business needs to grow if it&#x27;s going to survive, and its data management must grow along with it. But it&#x27;s very difficult to predict how much capacity the company will need, particularly with on-premises databases.</li><li><strong>Ensuring data residency, data sovereignty, or latency requirements</strong>: Some organizations have use cases that are better suited to run on-premises. In those cases, engineered systems that are pre-configured and pre-optimized for running the database are ideal.</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="sql-databases">SQL databases<a href="#sql-databases" class="hash-link" aria-label="SQL databases的直接链接" title="SQL databases的直接链接">​</a></h2><p>A SQL (or relational) database is a collection of data items with pre-defined relationships between them. These items are organized as a set of tables with columns and rows. Tables are used to hold information about the objects to be represented in the database. Each column in a table holds a certain kind of data and a field stores the actual value of an attribute. The rows in the table represent a collection of related values of one object or entity.</p><p>Each row in a table could be marked with a unique identifier called a primary key, and rows among multiple tables can be made related using foreign keys. This data can be accessed in many different ways without re-organizing the database tables themselves. SQL databases usually follow the <a href="https://karanpratapsingh.com/courses/system-design/acid-and-base-consistency-models#acid" target="_blank" rel="noopener noreferrer">ACID consistency model</a>.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="materialized-views">Materialized views<a href="#materialized-views" class="hash-link" aria-label="Materialized views的直接链接" title="Materialized views的直接链接">​</a></h3><p>A materialized view is a pre-computed data set derived from a query specification and stored for later use. Because the data is pre-computed, querying a materialized view is faster than executing a query against the base table of the view. This performance difference can be significant when a query is run frequently or is sufficiently complex.</p><p>It also enables data subsetting and improves the performance of complex queries that run on large data sets which reduces network loads. There are other uses of materialized views, but they are mostly used for performance and replication.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="n1-query-problem">N+1 query problem<a href="#n1-query-problem" class="hash-link" aria-label="N+1 query problem的直接链接" title="N+1 query problem的直接链接">​</a></h3><p>The N+1 query problem happens when the data access layer executes N additional SQL statements to fetch the same data that could have been retrieved when executing the primary SQL query. The larger the value of N, the more queries will be executed, the larger the performance impact.</p><p>This is commonly seen in GraphQL and ORM (Object-Relational Mapping) tools and can be addressed by optimizing the SQL query or using a dataloader that batches consecutive requests and makes a single data request under the hood.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="advantages">Advantages<a href="#advantages" class="hash-link" aria-label="Advantages的直接链接" title="Advantages的直接链接">​</a></h3><p>Let&#x27;s look at some advantages of using relational databases:</p><ul><li>Simple and accurate</li><li>Accessibility</li><li>Data consistency</li><li>Flexibility</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="disadvantages">Disadvantages<a href="#disadvantages" class="hash-link" aria-label="Disadvantages的直接链接" title="Disadvantages的直接链接">​</a></h3><p>Below are the disadvantages of relational databases:</p><ul><li>Expensive to maintain</li><li>Difficult schema evolution</li><li>Performance hits (join, denormalization, etc.)</li><li>Difficult to scale due to poor horizontal scalability</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="examples">Examples<a href="#examples" class="hash-link" aria-label="Examples的直接链接" title="Examples的直接链接">​</a></h3><p>Here are some commonly used relational databases:</p><ul><li><a href="https://www.postgresql.org" target="_blank" rel="noopener noreferrer">PostgreSQL</a></li><li><a href="https://www.mysql.com" target="_blank" rel="noopener noreferrer">MySQL</a></li><li><a href="https://mariadb.org" target="_blank" rel="noopener noreferrer">MariaDB</a></li><li><a href="https://aws.amazon.com/rds/aurora" target="_blank" rel="noopener noreferrer">Amazon Aurora</a></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="nosql-databases">NoSQL databases<a href="#nosql-databases" class="hash-link" aria-label="NoSQL databases的直接链接" title="NoSQL databases的直接链接">​</a></h2><p>NoSQL is a broad category that includes any database that doesn&#x27;t use SQL as its primary data access language. These types of databases are also sometimes referred to as non-relational databases. Unlike in relational databases, data in a NoSQL database doesn&#x27;t have to conform to a pre-defined schema. NoSQL databases follow <a href="https://karanpratapsingh.com/courses/system-design/acid-and-base-consistency-models#base" target="_blank" rel="noopener noreferrer">BASE consistency model</a>.</p><p>Below are different types of NoSQL databases:</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="document">Document<a href="#document" class="hash-link" aria-label="Document的直接链接" title="Document的直接链接">​</a></h4><p>A document database (also known as a document-oriented database or a document store) is a database that stores information in documents. They are general-purpose databases that serve a variety of use cases for both transactional and analytical applications.</p><p><strong>Advantages</strong></p><ul><li>Intuitive and flexible</li><li>Easy horizontal scaling</li><li>Schemaless</li></ul><p><strong>Disadvantages</strong></p><ul><li>Schemaless</li><li>Non-relational</li></ul><p><strong>Examples</strong></p><ul><li><a href="https://www.mongodb.com" target="_blank" rel="noopener noreferrer">MongoDB</a></li><li><a href="https://aws.amazon.com/documentdb" target="_blank" rel="noopener noreferrer">Amazon DocumentDB</a></li><li><a href="https://couchdb.apache.org" target="_blank" rel="noopener noreferrer">CouchDB</a></li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="key-value">Key-value<a href="#key-value" class="hash-link" aria-label="Key-value的直接链接" title="Key-value的直接链接">​</a></h4><p>One of the simplest types of NoSQL databases, key-value databases save data as a group of key-value pairs made up of two data items each. They&#x27;re also sometimes referred to as a key-value store.</p><p><strong>Advantages</strong></p><ul><li>Simple and performant</li><li>Highly scalable for high volumes of traffic</li><li>Session management</li><li>Optimized lookups</li></ul><p><strong>Disadvantages</strong></p><ul><li>Basic CRUD</li><li>Values can&#x27;t be filtered</li><li>Lacks indexing and scanning capabilities</li><li>Not optimized for complex queries</li></ul><p><strong>Examples</strong></p><ul><li><a href="https://redis.io" target="_blank" rel="noopener noreferrer">Redis</a></li><li><a href="https://memcached.org" target="_blank" rel="noopener noreferrer">Memcached</a></li><li><a href="https://aws.amazon.com/dynamodb" target="_blank" rel="noopener noreferrer">Amazon DynamoDB</a></li><li><a href="https://aerospike.com" target="_blank" rel="noopener noreferrer">Aerospike</a></li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="graph">Graph<a href="#graph" class="hash-link" aria-label="Graph的直接链接" title="Graph的直接链接">​</a></h4><p>A graph database is a NoSQL database that uses graph structures for semantic queries with nodes, edges, and properties to represent and store data instead of tables or documents.</p><p>The graph relates the data items in the store to a collection of nodes and edges, the edges representing the relationships between the nodes. The relationships allow data in the store to be linked together directly and, in many cases, retrieved with one operation.</p><p><strong>Advantages</strong></p><ul><li>Query speed</li><li>Agile and flexible</li><li>Explicit data representation</li></ul><p><strong>Disadvantages</strong></p><ul><li>Complex</li><li>No standardized query language</li></ul><p><strong>Use cases</strong></p><ul><li>Fraud detection</li><li>Recommendation engines</li><li>Social networks</li><li>Network mapping</li></ul><p><strong>Examples</strong></p><ul><li><a href="https://neo4j.com" target="_blank" rel="noopener noreferrer">Neo4j</a></li><li><a href="https://www.arangodb.com" target="_blank" rel="noopener noreferrer">ArangoDB</a></li><li><a href="https://aws.amazon.com/neptune" target="_blank" rel="noopener noreferrer">Amazon Neptune</a></li><li><a href="https://janusgraph.org" target="_blank" rel="noopener noreferrer">JanusGraph</a></li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="time-series">Time series<a href="#time-series" class="hash-link" aria-label="Time series的直接链接" title="Time series的直接链接">​</a></h4><p>A time-series database is a database optimized for time-stamped, or time series, data.</p><p><strong>Advantages</strong></p><ul><li>Fast insertion and retrieval</li><li>Efficient data storage</li></ul><p><strong>Use cases</strong></p><ul><li>IoT data</li><li>Metrics analysis</li><li>Application monitoring</li><li>Understand financial trends</li></ul><p><strong>Examples</strong></p><ul><li><a href="https://www.influxdata.com" target="_blank" rel="noopener noreferrer">InfluxDB</a></li><li><a href="https://druid.apache.org" target="_blank" rel="noopener noreferrer">Apache Druid</a></li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="wide-column">Wide column<a href="#wide-column" class="hash-link" aria-label="Wide column的直接链接" title="Wide column的直接链接">​</a></h4><p>Wide column databases, also known as wide column stores, are schema-agnostic. Data is stored in column families, rather than in rows and columns.</p><p><strong>Advantages</strong></p><ul><li>Highly scalable, can handle petabytes of data</li><li>Ideal for real-time big data applications</li></ul><p><strong>Disadvantages</strong></p><ul><li>Expensive</li><li>Increased write time</li></ul><p><strong>Use cases</strong></p><ul><li>Business analytics</li><li>Attribute-based data storage</li></ul><p><strong>Examples</strong></p><ul><li><a href="https://cloud.google.com/bigtable" target="_blank" rel="noopener noreferrer">BigTable</a></li><li><a href="https://cassandra.apache.org" target="_blank" rel="noopener noreferrer">Apache Cassandra</a></li><li><a href="https://www.scylladb.com" target="_blank" rel="noopener noreferrer">ScyllaDB</a></li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="multi-model">Multi-model<a href="#multi-model" class="hash-link" aria-label="Multi-model的直接链接" title="Multi-model的直接链接">​</a></h4><p>Multi-model databases combine different database models (i.e. relational, graph, key-value, document, etc.) into a single, integrated backend. This means they can accommodate various data types, indexes, queries, and store data in more than one model.</p><p><strong>Advantages</strong></p><ul><li>Flexibility</li><li>Suitable for complex projects</li><li>Data consistent</li></ul><p><strong>Disadvantages</strong></p><ul><li>Complex</li><li>Less mature</li></ul><p><strong>Examples</strong></p><ul><li><a href="https://www.arangodb.com" target="_blank" rel="noopener noreferrer">ArangoDB</a></li><li><a href="https://azure.microsoft.com/en-in/services/cosmos-db" target="_blank" rel="noopener noreferrer">Azure Cosmos DB</a></li><li><a href="https://www.couchbase.com" target="_blank" rel="noopener noreferrer">Couchbase</a></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="sql-vs-nosql-databases">SQL vs NoSQL databases<a href="#sql-vs-nosql-databases" class="hash-link" aria-label="SQL vs NoSQL databases的直接链接" title="SQL vs NoSQL databases的直接链接">​</a></h2><p>In the world of databases, there are two main types of solutions, SQL (relational) and NoSQL (non-relational) databases. Both of them differ in the way they were built, the kind of information they store, and how they store it. Relational databases are structured and have predefined schemas while non-relational databases are unstructured, distributed, and have a dynamic schema.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="high-level-differences">High-level differences<a href="#high-level-differences" class="hash-link" aria-label="High-level differences的直接链接" title="High-level differences的直接链接">​</a></h3><p>Here are some high-level differences between SQL and NoSQL:</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="storage">Storage<a href="#storage" class="hash-link" aria-label="Storage的直接链接" title="Storage的直接链接">​</a></h4><p>SQL stores data in tables, where each row represents an entity and each column represents a data point about that entity.</p><p>NoSQL databases have different data storage models such as key-value, graph, document, etc.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="schema-1">Schema<a href="#schema-1" class="hash-link" aria-label="Schema的直接链接" title="Schema的直接链接">​</a></h4><p>In SQL, each record conforms to a fixed schema, meaning the columns must be decided and chosen before data entry and each row must have data for each column. The schema can be altered later, but it involves modifying the database using migrations.</p><p>Whereas in NoSQL, schemas are dynamic. Fields can be added on the fly, and each <em>record</em> (or equivalent) doesn&#x27;t have to contain data for each <em>field</em>.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="querying">Querying<a href="#querying" class="hash-link" aria-label="Querying的直接链接" title="Querying的直接链接">​</a></h4><p>SQL databases use SQL (structured query language) for defining and manipulating the data, which is very powerful.</p><p>In a NoSQL database, queries are focused on a collection of documents. Different databases have different syntax for querying.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="scalability">Scalability<a href="#scalability" class="hash-link" aria-label="Scalability的直接链接" title="Scalability的直接链接">​</a></h4><p>In most common situations, SQL databases are vertically scalable, which can get very expensive. It is possible to scale a relational database across multiple servers, but this is a challenging and time-consuming process.</p><p>On the other hand, NoSQL databases are horizontally scalable, meaning we can add more servers easily to our NoSQL database infrastructure to handle large traffic. Any cheap commodity hardware or cloud instances can host NoSQL databases, thus making it a lot more cost-effective than vertical scaling. A lot of NoSQL technologies also distribute data across servers automatically.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="reliability">Reliability<a href="#reliability" class="hash-link" aria-label="Reliability的直接链接" title="Reliability的直接链接">​</a></h4><p>The vast majority of relational databases are ACID compliant. So, when it comes to data reliability and a safe guarantee of performing transactions, SQL databases are still the better bet.</p><p>Most of the NoSQL solutions sacrifice ACID compliance for performance and scalability.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="reasons">Reasons<a href="#reasons" class="hash-link" aria-label="Reasons的直接链接" title="Reasons的直接链接">​</a></h3><p>As always we should always pick the technology that fits the requirements better. So, let&#x27;s look at some reasons for picking SQL or NoSQL based database:</p><p><strong>For SQL</strong></p><ul><li>Structured data with strict schema</li><li>Relational data</li><li>Need for complex joins</li><li>Transactions</li><li>Lookups by index are very fast</li></ul><p><strong>For NoSQL</strong></p><ul><li>Dynamic or flexible schema</li><li>Non-relational data</li><li>No need for complex joins</li><li>Very data-intensive workload</li><li>Very high throughput for IOPS</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="database-replication">Database Replication<a href="#database-replication" class="hash-link" aria-label="Database Replication的直接链接" title="Database Replication的直接链接">​</a></h2><p>Replication is a process that involves sharing information to ensure consistency between redundant resources such as multiple databases, to improve reliability, fault-tolerance, or accessibility.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="master-slave-replication">Master-Slave Replication<a href="#master-slave-replication" class="hash-link" aria-label="Master-Slave Replication的直接链接" title="Master-Slave Replication的直接链接">​</a></h3><p>The master serves reads and writes, replicating writes to one or more slaves, which serve only reads. Slaves can also replicate additional slaves in a tree-like fashion. If the master goes offline, the system can continue to operate in read-only mode until a slave is promoted to a master or a new master is provisioned.</p><p><img loading="lazy" src="https://raw.githubusercontent.com/karanpratapsingh/portfolio/master/public/static/courses/system-design/chapter-II/database-replication/master-slave-replication.png" alt="master-slave-replication" class="img_ev3q"></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="advantages-1">Advantages<a href="#advantages-1" class="hash-link" aria-label="Advantages的直接链接" title="Advantages的直接链接">​</a></h4><ul><li>Backups of the entire database of relatively no impact on the master.</li><li>Applications can read from the slave(s) without impacting the master.</li><li>Slaves can be taken offline and synced back to the master without any downtime.</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="disadvantages-1">Disadvantages<a href="#disadvantages-1" class="hash-link" aria-label="Disadvantages的直接链接" title="Disadvantages的直接链接">​</a></h4><ul><li>Replication adds more hardware and additional complexity.</li><li>Downtime and possibly loss of data when a master fails.</li><li>All writes also have to be made to the master in a master-slave architecture.</li><li>The more read slaves, the more we have to replicate, which will increase replication lag.</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="master-master-replication">Master-Master Replication<a href="#master-master-replication" class="hash-link" aria-label="Master-Master Replication的直接链接" title="Master-Master Replication的直接链接">​</a></h3><p>Both masters serve reads/writes and coordinate with each other. If either master goes down, the system can continue to operate with both reads and writes.</p><p><img loading="lazy" src="https://raw.githubusercontent.com/karanpratapsingh/portfolio/master/public/static/courses/system-design/chapter-II/database-replication/master-master-replication.png" alt="master-master-replication" class="img_ev3q"></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="advantages-2">Advantages<a href="#advantages-2" class="hash-link" aria-label="Advantages的直接链接" title="Advantages的直接链接">​</a></h4><ul><li>Applications can read from both masters.</li><li>Distributes write load across both master nodes.</li><li>Simple, automatic, and quick failover.</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="disadvantages-2">Disadvantages<a href="#disadvantages-2" class="hash-link" aria-label="Disadvantages的直接链接" title="Disadvantages的直接链接">​</a></h4><ul><li>Not as simple as master-slave to configure and deploy.</li><li>Either loosely consistent or have increased write latency due to synchronization.</li><li>Conflict resolution comes into play as more write nodes are added and as latency increases.</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="synchronous-vs-asynchronous-replication">Synchronous vs Asynchronous replication<a href="#synchronous-vs-asynchronous-replication" class="hash-link" aria-label="Synchronous vs Asynchronous replication的直接链接" title="Synchronous vs Asynchronous replication的直接链接">​</a></h3><p>The primary difference between synchronous and asynchronous replication is how the data is written to the replica. In synchronous replication, data is written to primary storage and the replica simultaneously. As such, the primary copy and the replica should always remain synchronized.</p><p>In contrast, asynchronous replication copies the data to the replica after the data is already written to the primary storage. Although the replication process may occur in near-real-time, it is more common for replication to occur on a scheduled basis and it is more cost-effective.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="indexes">Indexes<a href="#indexes" class="hash-link" aria-label="Indexes的直接链接" title="Indexes的直接链接">​</a></h2><p>Indexes are well known when it comes to databases, they are used to improve the speed of data retrieval operations on the data store. An index makes the trade-offs of increased storage overhead, and slower writes (since we not only have to write the data but also have to update the index) for the benefit of faster reads. Indexes are used to quickly locate data without having to examine every row in a database table. Indexes can be created using one or more columns of a database table, providing the basis for both rapid random lookups and efficient access to ordered records.</p><p><img loading="lazy" src="https://raw.githubusercontent.com/karanpratapsingh/portfolio/master/public/static/courses/system-design/chapter-II/indexes/indexes.png" alt="indexes" class="img_ev3q"></p><p>An index is a data structure that can be perceived as a table of contents that points us to the location where actual data lives. So when we create an index on a column of a table, we store that column and a pointer to the whole row in the index. Indexes are also used to create different views of the same data. For large data sets, this is an excellent way to specify different filters or sorting schemes without resorting to creating multiple additional copies of the data.</p><p>One quality that database indexes can have is that they can be <strong>dense</strong> or <strong>sparse</strong>. Each of these index qualities comes with its own trade-offs. Let&#x27;s look at how each index type would work:</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="dense-index">Dense Index<a href="#dense-index" class="hash-link" aria-label="Dense Index的直接链接" title="Dense Index的直接链接">​</a></h3><p>In a dense index, an index record is created for every row of the table. Records can be located directly as each record of the index holds the search key value and the pointer to the actual record.</p><p><img loading="lazy" src="https://raw.githubusercontent.com/karanpratapsingh/portfolio/master/public/static/courses/system-design/chapter-II/indexes/dense-index.png" alt="dense-index" class="img_ev3q"></p><p>Dense indexes require more maintenance than sparse indexes at write-time. Since every row must have an entry, the database must maintain the index on inserts, updates, and deletes. Having an entry for every row also means that dense indexes will require more memory. The benefit of a dense index is that values can be quickly found with just a binary search. Dense indexes also do not impose any ordering requirements on the data.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="sparse-index">Sparse Index<a href="#sparse-index" class="hash-link" aria-label="Sparse Index的直接链接" title="Sparse Index的直接链接">​</a></h3><p>In a sparse index, records are created only for some of the records.</p><p><img loading="lazy" src="https://raw.githubusercontent.com/karanpratapsingh/portfolio/master/public/static/courses/system-design/chapter-II/indexes/sparse-index.png" alt="sparse-index" class="img_ev3q"></p><p>Sparse indexes require less maintenance than dense indexes at write-time since they only contain a subset of the values. This lighter maintenance burden means that inserts, updates, and deletes will be faster. Having fewer entries also means that the index will use less memory. Finding data is slower since a scan across the page typically follows the binary search. Sparse indexes are also optional when working with ordered data.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="normalization-and-denormalization">Normalization and Denormalization<a href="#normalization-and-denormalization" class="hash-link" aria-label="Normalization and Denormalization的直接链接" title="Normalization and Denormalization的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="terms">Terms<a href="#terms" class="hash-link" aria-label="Terms的直接链接" title="Terms的直接链接">​</a></h3><p>Before we go any further, let&#x27;s look at some commonly used terms in normalization and denormalization.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="keys">Keys<a href="#keys" class="hash-link" aria-label="Keys的直接链接" title="Keys的直接链接">​</a></h4><p><strong>Primary key</strong>: Column or group of columns that can be used to uniquely identify every row of the table.</p><p><strong>Composite key</strong>: A primary key made up of multiple columns.</p><p><strong>Super key</strong>: Set of all keys that can uniquely identify all the rows present in a table.</p><p><strong>Candidate key</strong>: Attributes that identify rows uniquely in a table.</p><p><strong>Foreign key</strong>: It is a reference to a primary key of another table.</p><p><strong>Alternate key</strong>: Keys that are not primary keys are known as alternate keys.</p><p><strong>Surrogate key</strong>: A system-generated value that uniquely identifies each entry in a table when no other column was able to hold properties of a primary key.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="dependencies">Dependencies<a href="#dependencies" class="hash-link" aria-label="Dependencies的直接链接" title="Dependencies的直接链接">​</a></h4><p><strong>Partial dependency</strong>: Occurs when the primary key determines some other attributes.</p><p><strong>Functional dependency</strong>: It is a relationship that exists between two attributes, typically between the primary key and non-key attribute within a table.</p><p><strong>Transitive functional dependency</strong>: Occurs when some non-key attribute determines some other attribute.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="anomalies">Anomalies<a href="#anomalies" class="hash-link" aria-label="Anomalies的直接链接" title="Anomalies的直接链接">​</a></h4><p>Database anomaly happens when there is a flaw in the database due to incorrect planning or storing everything in a flat database. This is generally addressed by the process of normalization.</p><p>There are three types of database anomalies:</p><p><strong>Insertion anomaly</strong>: Occurs when we are not able to insert certain attributes in the database without the presence of other attributes.</p><p><strong>Update anomaly</strong>: Occurs in case of data redundancy and partial update. In other words, a correct update of the database needs other actions such as addition, deletion, or both.</p><p><strong>Deletion anomaly</strong>: Occurs where deletion of some data requires deletion of other data.</p><p><strong>Example</strong></p><p>Let&#x27;s consider the following table which is not normalized:</p><table><thead><tr><th>ID</th><th>Name</th><th>Role</th><th>Team</th></tr></thead><tbody><tr><td>1</td><td>Peter</td><td>Software Engineer</td><td>A</td></tr><tr><td>2</td><td>Brian</td><td>DevOps Engineer</td><td>B</td></tr><tr><td>3</td><td>Hailey</td><td>Product Manager</td><td>C</td></tr><tr><td>4</td><td>Hailey</td><td>Product Manager</td><td>C</td></tr><tr><td>5</td><td>Steve</td><td>Frontend Engineer</td><td>D</td></tr></tbody></table><p>Let&#x27;s imagine, we hired a new person &quot;John&quot; but they might not be assigned a team immediately. This will cause an <em>insertion anomaly</em> as the team attribute is not yet present.</p><p>Next, let&#x27;s say Hailey from Team C got promoted, to reflect that change in the database, we will need to update 2 rows to maintain consistency which can cause an <em>update anomaly</em>.</p><p>Finally, we would like to remove Team B but to do that we will also need to remove additional information such as name and role, this is an example of a <em>deletion anomaly</em>.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="normalization">Normalization<a href="#normalization" class="hash-link" aria-label="Normalization的直接链接" title="Normalization的直接链接">​</a></h3><p>Normalization is the process of organizing data in a database. This includes creating tables and establishing relationships between those tables according to rules designed both to protect the data and to make the database more flexible by eliminating redundancy and inconsistent dependency.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="why-do-we-need-normalization">Why do we need normalization?<a href="#why-do-we-need-normalization" class="hash-link" aria-label="Why do we need normalization?的直接链接" title="Why do we need normalization?的直接链接">​</a></h4><p>The goal of normalization is to eliminate redundant data and ensure data is consistent. A fully normalized database allows its structure to be extended to accommodate new types of data without changing the existing structure too much. As a result, applications interacting with the database are minimally affected.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="normal-forms">Normal forms<a href="#normal-forms" class="hash-link" aria-label="Normal forms的直接链接" title="Normal forms的直接链接">​</a></h4><p>Normal forms are a series of guidelines to ensure that the database is normalized. Let&#x27;s discuss some essential normal forms:</p><p><strong>1NF</strong></p><p>For a table to be in the first normal form (1NF), it should follow the following rules:</p><ul><li>Repeating groups are not permitted.</li><li>Identify each set of related data with a primary key.</li><li>Set of related data should have a separate table.</li><li>Mixing data types in the same column is not permitted.</li></ul><p><strong>2NF</strong></p><p>For a table to be in the second normal form (2NF), it should follow the following rules:</p><ul><li>Satisfies the first normal form (1NF).</li><li>Should not have any partial dependency.</li></ul><p><strong>3NF</strong></p><p>For a table to be in the third normal form (3NF), it should follow the following rules:</p><ul><li>Satisfies the second normal form (2NF).</li><li>Transitive functional dependencies are not permitted.</li></ul><p><strong>BCNF</strong></p><p>Boyce-Codd normal form (or BCNF) is a slightly stronger version of the third normal form (3NF) used to address certain types of anomalies not dealt with by 3NF as originally defined. Sometimes it is also known as the 3.5 normal form (3.5NF).</p><p>For a table to be in the Boyce-Codd normal form (BCNF), it should follow the following rules:</p><ul><li>Satisfied the third normal form (3NF).</li><li>For every functional dependency X → Y, X should be the super key.</li></ul><p><em>There are more normal forms such as 4NF, 5NF, and 6NF but we won&#x27;t discuss them here. Check out this <a href="https://www.youtube.com/watch?v=GFQaEYEc8_8" target="_blank" rel="noopener noreferrer">amazing video</a> that goes into detail.</em></p><p>In a relational database, a relation is often described as <em>&quot;normalized&quot;</em> if it meets the third normal form. Most 3NF relations are free of insertion, update, and deletion anomalies.</p><p>As with many formal rules and specifications, real-world scenarios do not always allow for perfect compliance. If you decide to violate one of the first three rules of normalization, make sure that your application anticipates any problems that could occur, such as redundant data and inconsistent dependencies.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="advantages-3">Advantages<a href="#advantages-3" class="hash-link" aria-label="Advantages的直接链接" title="Advantages的直接链接">​</a></h4><p>Here are some advantages of normalization:</p><ul><li>Reduces data redundancy.</li><li>Better data design.</li><li>Increases data consistency.</li><li>Enforces referential integrity.</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="disadvantages-3">Disadvantages<a href="#disadvantages-3" class="hash-link" aria-label="Disadvantages的直接链接" title="Disadvantages的直接链接">​</a></h4><p>Let&#x27;s look at some disadvantages of normalization:</p><ul><li>Data design is complex.</li><li>Slower performance.</li><li>Maintenance overhead.</li><li>Require more joins.</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="denormalization">Denormalization<a href="#denormalization" class="hash-link" aria-label="Denormalization的直接链接" title="Denormalization的直接链接">​</a></h3><p>Denormalization is a database optimization technique in which we add redundant data to one or more tables. This can help us avoid costly joins in a relational database. It attempts to improve read performance at the expense of some write performance. Redundant copies of the data are written in multiple tables to avoid expensive joins.</p><p>Once data becomes distributed with techniques such as federation and sharding, managing joins across the network further increases complexity. Denormalization might circumvent the need for such complex joins.</p><p><em>Note: Denormalization does not mean reversing normalization.</em></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="advantages-4">Advantages<a href="#advantages-4" class="hash-link" aria-label="Advantages的直接链接" title="Advantages的直接链接">​</a></h4><p>Let&#x27;s look at some advantages of denormalization:</p><ul><li>Retrieving data is faster.</li><li>Writing queries is easier.</li><li>Reduction in number of tables.</li><li>Convenient to manage.</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="disadvantages-4">Disadvantages<a href="#disadvantages-4" class="hash-link" aria-label="Disadvantages的直接链接" title="Disadvantages的直接链接">​</a></h4><p>Below are some disadvantages of denormalization:</p><ul><li>Expensive inserts and updates.</li><li>Increases complexity of database design.</li><li>Increases data redundancy.</li><li>More chances of data inconsistency.</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="acid-and-base-consistency-models">ACID and BASE consistency models<a href="#acid-and-base-consistency-models" class="hash-link" aria-label="ACID and BASE consistency models的直接链接" title="ACID and BASE consistency models的直接链接">​</a></h2><p>Let&#x27;s discuss the ACID and BASE consistency models.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="acid">ACID<a href="#acid" class="hash-link" aria-label="ACID的直接链接" title="ACID的直接链接">​</a></h3><p>The term ACID stands for Atomicity, Consistency, Isolation, and Durability. ACID properties are used for maintaining data integrity during transaction processing.</p><p>In order to maintain consistency before and after a transaction relational databases follow ACID properties. Let us understand these terms:</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="atomic">Atomic<a href="#atomic" class="hash-link" aria-label="Atomic的直接链接" title="Atomic的直接链接">​</a></h4><p>All operations in a transaction succeed or every operation is rolled back.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="consistent">Consistent<a href="#consistent" class="hash-link" aria-label="Consistent的直接链接" title="Consistent的直接链接">​</a></h4><p>On the completion of a transaction, the database is structurally sound.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="isolated">Isolated<a href="#isolated" class="hash-link" aria-label="Isolated的直接链接" title="Isolated的直接链接">​</a></h4><p>Transactions do not contend with one another. Contentious access to data is moderated by the database so that transactions appear to run sequentially.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="durable">Durable<a href="#durable" class="hash-link" aria-label="Durable的直接链接" title="Durable的直接链接">​</a></h4><p>Once the transaction has been completed and the writes and updates have been written to the disk, it will remain in the system even if a system failure occurs.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="base">BASE<a href="#base" class="hash-link" aria-label="BASE的直接链接" title="BASE的直接链接">​</a></h3><p>With the increasing amount of data and high availability requirements, the approach to database design has also changed dramatically. To increase the ability to scale and at the same time be highly available, we move the logic from the database to separate servers. In this way, the database becomes more independent and focused on the actual process of storing data.</p><p>In the NoSQL database world, ACID transactions are less common as some databases have loosened the requirements for immediate consistency, data freshness, and accuracy in order to gain other benefits, like scale and resilience.</p><p>BASE properties are much looser than ACID guarantees, but there isn&#x27;t a direct one-for-one mapping between the two consistency models. Let us understand these terms:</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="basic-availability">Basic Availability<a href="#basic-availability" class="hash-link" aria-label="Basic Availability的直接链接" title="Basic Availability的直接链接">​</a></h4><p>The database appears to work most of the time.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="soft-state">Soft-state<a href="#soft-state" class="hash-link" aria-label="Soft-state的直接链接" title="Soft-state的直接链接">​</a></h4><p>Stores don&#x27;t have to be write-consistent, nor do different replicas have to be mutually consistent all the time.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="eventual-consistency">Eventual consistency<a href="#eventual-consistency" class="hash-link" aria-label="Eventual consistency的直接链接" title="Eventual consistency的直接链接">​</a></h4><p>The data might not be consistent immediately but eventually, it becomes consistent. Reads in the system are still possible even though they may not give the correct response due to inconsistency.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="acid-vs-base-trade-offs">ACID vs BASE Trade-offs<a href="#acid-vs-base-trade-offs" class="hash-link" aria-label="ACID vs BASE Trade-offs的直接链接" title="ACID vs BASE Trade-offs的直接链接">​</a></h3><p>There&#x27;s no right answer to whether our application needs an ACID or a BASE consistency model. Both the models have been designed to satisfy different requirements. While choosing a database we need to keep the properties of both the models and the requirements of our application in mind.</p><p>Given BASE&#x27;s loose consistency, developers need to be more knowledgeable and rigorous about consistent data if they choose a BASE store for their application. It&#x27;s essential to be familiar with the BASE behavior of the chosen database and work within those constraints.</p><p>On the other hand, planning around BASE limitations can sometimes be a major disadvantage when compared to the simplicity of ACID transactions. A fully ACID database is the perfect fit for use cases where data reliability and consistency are essential.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="cap-theorem">CAP Theorem<a href="#cap-theorem" class="hash-link" aria-label="CAP Theorem的直接链接" title="CAP Theorem的直接链接">​</a></h2><p>CAP theorem states that a distributed system can deliver only two of the three desired characteristics Consistency, Availability, and Partition tolerance (CAP).</p><p><img loading="lazy" src="https://raw.githubusercontent.com/karanpratapsingh/portfolio/master/public/static/courses/system-design/chapter-II/cap-theorem/cap-theorem.png" alt="cap-theorem" class="img_ev3q"></p><p>Let&#x27;s take a detailed look at the three distributed system characteristics to which the CAP theorem refers.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="consistency">Consistency<a href="#consistency" class="hash-link" aria-label="Consistency的直接链接" title="Consistency的直接链接">​</a></h4><p>Consistency means that all clients see the same data at the same time, no matter which node they connect to. For this to happen, whenever data is written to one node, it must be instantly forwarded or replicated across all the nodes in the system before the write is deemed &quot;successful&quot;.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="availability">Availability<a href="#availability" class="hash-link" aria-label="Availability的直接链接" title="Availability的直接链接">​</a></h4><p>Availability means that any client making a request for data gets a response, even if one or more nodes are down.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="partition-tolerance">Partition tolerance<a href="#partition-tolerance" class="hash-link" aria-label="Partition tolerance的直接链接" title="Partition tolerance的直接链接">​</a></h4><p>Partition tolerance means the system continues to work despite message loss or partial failure. A system that is partition-tolerant can sustain any amount of network failure that doesn&#x27;t result in a failure of the entire network. Data is sufficiently replicated across combinations of nodes and networks to keep the system up through intermittent outages.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="consistency-availability-tradeoff">Consistency-Availability Tradeoff<a href="#consistency-availability-tradeoff" class="hash-link" aria-label="Consistency-Availability Tradeoff的直接链接" title="Consistency-Availability Tradeoff的直接链接">​</a></h3><p>We live in a physical world and can&#x27;t guarantee the stability of a network, so distributed databases must choose Partition Tolerance (P). This implies a tradeoff between Consistency (C) and Availability (A).</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="ca-database">CA database<a href="#ca-database" class="hash-link" aria-label="CA database的直接链接" title="CA database的直接链接">​</a></h4><p>A CA database delivers consistency and availability across all nodes. It can&#x27;t do this if there is a partition between any two nodes in the system, and therefore can&#x27;t deliver fault tolerance.</p><p><strong>Example</strong>: <a href="https://www.postgresql.org" target="_blank" rel="noopener noreferrer">PostgreSQL</a>, <a href="https://mariadb.org" target="_blank" rel="noopener noreferrer">MariaDB</a>.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="cp-database">CP database<a href="#cp-database" class="hash-link" aria-label="CP database的直接链接" title="CP database的直接链接">​</a></h4><p>A CP database delivers consistency and partition tolerance at the expense of availability. When a partition occurs between any two nodes, the system has to shut down the non-consistent node until the partition is resolved.</p><p><strong>Example</strong>: <a href="https://www.mongodb.com" target="_blank" rel="noopener noreferrer">MongoDB</a>, <a href="https://hbase.apache.org" target="_blank" rel="noopener noreferrer">Apache HBase</a>.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="ap-database">AP database<a href="#ap-database" class="hash-link" aria-label="AP database的直接链接" title="AP database的直接链接">​</a></h4><p>An AP database delivers availability and partition tolerance at the expense of consistency. When a partition occurs, all nodes remain available but those at the wrong end of a partition might return an older version of data than others. When the partition is resolved, the AP databases typically re-syncs the nodes to repair all inconsistencies in the system.</p><p><strong>Example</strong>: <a href="https://cassandra.apache.org" target="_blank" rel="noopener noreferrer">Apache Cassandra</a>, <a href="https://couchdb.apache.org" target="_blank" rel="noopener noreferrer">CouchDB</a>.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="pacelc-theorem">PACELC Theorem<a href="#pacelc-theorem" class="hash-link" aria-label="PACELC Theorem的直接链接" title="PACELC Theorem的直接链接">​</a></h2><p>The PACELC theorem is an extension of the CAP theorem. The CAP theorem states that in the case of network partitioning (P) in a distributed system, one has to choose between Availability (A) and Consistency (C).</p><p>PACELC extends the CAP theorem by introducing latency (L) as an additional attribute of a distributed system. The theorem states that else (E), even when the system is running normally in the absence of partitions, one has to choose between latency (L) and consistency (C).</p><p><em>The PACELC theorem was first described by <a href="https://scholar.google.com/citations?user=zxeEF2gAAAAJ" target="_blank" rel="noopener noreferrer">Daniel J. Abadi</a>.</em></p><p><img loading="lazy" src="https://raw.githubusercontent.com/karanpratapsingh/portfolio/master/public/static/courses/system-design/chapter-II/pacelc-theorem/pacelc-theorem.png" alt="pacelc-theorem" class="img_ev3q"></p><p>PACELC theorem was developed to address a key limitation of the CAP theorem as it makes no provision for performance or latency.</p><p>For example, according to the CAP theorem, a database can be considered Available if a query returns a response after 30 days. Obviously, such latency would be unacceptable for any real-world application.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="transactions">Transactions<a href="#transactions" class="hash-link" aria-label="Transactions的直接链接" title="Transactions的直接链接">​</a></h2><p>A transaction is a series of database operations that are considered to be a <em>&quot;single unit of work&quot;</em>. The operations in a transaction either all succeed, or they all fail. In this way, the notion of a transaction supports data integrity when part of a system fails. Not all databases choose to support ACID transactions, usually because they are prioritizing other optimizations that are hard or theoretically impossible to implement together.</p><p><em>Usually, relational databases support ACID transactions, and non-relational databases don&#x27;t (there are exceptions).</em></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="states">States<a href="#states" class="hash-link" aria-label="States的直接链接" title="States的直接链接">​</a></h3><p>A transaction in a database can be in one of the following states:</p><p><img loading="lazy" src="https://raw.githubusercontent.com/karanpratapsingh/portfolio/master/public/static/courses/system-design/chapter-II/transactions/transaction-states.png" alt="transaction-states" class="img_ev3q"></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="active">Active<a href="#active" class="hash-link" aria-label="Active的直接链接" title="Active的直接链接">​</a></h4><p>In this state, the transaction is being executed. This is the initial state of every transaction.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="partially-committed">Partially Committed<a href="#partially-committed" class="hash-link" aria-label="Partially Committed的直接链接" title="Partially Committed的直接链接">​</a></h4><p>When a transaction executes its final operation, it is said to be in a partially committed state.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="committed">Committed<a href="#committed" class="hash-link" aria-label="Committed的直接链接" title="Committed的直接链接">​</a></h4><p>If a transaction executes all its operations successfully, it is said to be committed. All its effects are now permanently established on the database system.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="failed">Failed<a href="#failed" class="hash-link" aria-label="Failed的直接链接" title="Failed的直接链接">​</a></h4><p>The transaction is said to be in a failed state if any of the checks made by the database recovery system fails. A failed transaction can no longer proceed further.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="aborted">Aborted<a href="#aborted" class="hash-link" aria-label="Aborted的直接链接" title="Aborted的直接链接">​</a></h4><p>If any of the checks fail and the transaction has reached a failed state, then the recovery manager rolls back all its write operations on the database to bring the database back to its original state where it was prior to the execution of the transaction. Transactions in this state are aborted.</p><p>The database recovery module can select one of the two operations after a transaction aborts:</p><ul><li>Restart the transaction</li><li>Kill the transaction</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="terminated">Terminated<a href="#terminated" class="hash-link" aria-label="Terminated的直接链接" title="Terminated的直接链接">​</a></h4><p>If there isn&#x27;t any roll-back or the transaction comes from the <em>committed state</em>, then the system is consistent and ready for a new transaction and the old transaction is terminated.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="distributed-transactions">Distributed Transactions<a href="#distributed-transactions" class="hash-link" aria-label="Distributed Transactions的直接链接" title="Distributed Transactions的直接链接">​</a></h2><p>A distributed transaction is a set of operations on data that is performed across two or more databases. It is typically coordinated across separate nodes connected by a network, but may also span multiple databases on a single server.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="why-do-we-need-distributed-transactions">Why do we need distributed transactions?<a href="#why-do-we-need-distributed-transactions" class="hash-link" aria-label="Why do we need distributed transactions?的直接链接" title="Why do we need distributed transactions?的直接链接">​</a></h3><p>Unlike an ACID transaction on a single database, a distributed transaction involves altering data on multiple databases. Consequently, distributed transaction processing is more complicated, because the database must coordinate the committing or rollback of the changes in a transaction as a self-contained unit.</p><p>In other words, all the nodes must commit, or all must abort and the entire transaction rolls back. This is why we need distributed transactions.</p><p>Now, let&#x27;s look at some popular solutions for distributed transactions:</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="two-phase-commit">Two-Phase commit<a href="#two-phase-commit" class="hash-link" aria-label="Two-Phase commit的直接链接" title="Two-Phase commit的直接链接">​</a></h3><p><img loading="lazy" src="https://raw.githubusercontent.com/karanpratapsingh/portfolio/master/public/static/courses/system-design/chapter-II/distributed-transactions/two-phase-commit.png" alt="two-phase-commit" class="img_ev3q"></p><p>The two-phase commit (2PC) protocol is a distributed algorithm that coordinates all the processes that participate in a distributed transaction on whether to commit or abort (roll back) the transaction.</p><p>This protocol achieves its goal even in many cases of temporary system failure and is thus widely used. However, it is not resilient to all possible failure configurations, and in rare cases, manual intervention is needed to remedy an outcome.</p><p>This protocol requires a coordinator node, which basically coordinates and oversees the transaction across different nodes. The coordinator tries to establish the consensus among a set of processes in two phases, hence the name.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="phases">Phases<a href="#phases" class="hash-link" aria-label="Phases的直接链接" title="Phases的直接链接">​</a></h4><p>Two-phase commit consists of the following phases:</p><p><strong>Prepare phase</strong></p><p>The prepare phase involves the coordinator node collecting consensus from each of the participant nodes. The transaction will be aborted unless each of the nodes responds that they&#x27;re <em>prepared</em>.</p><p><strong>Commit phase</strong></p><p>If all participants respond to the coordinator that they are <em>prepared</em>, then the coordinator asks all the nodes to commit the transaction. If a failure occurs, the transaction will be rolled back.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="problems">Problems<a href="#problems" class="hash-link" aria-label="Problems的直接链接" title="Problems的直接链接">​</a></h4><p>Following problems may arise in the two-phase commit protocol:</p><ul><li>What if one of the nodes crashes?</li><li>What if the coordinator itself crashes?</li><li>It is a blocking protocol.</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="three-phase-commit">Three-phase commit<a href="#three-phase-commit" class="hash-link" aria-label="Three-phase commit的直接链接" title="Three-phase commit的直接链接">​</a></h3><p><img loading="lazy" src="https://raw.githubusercontent.com/karanpratapsingh/portfolio/master/public/static/courses/system-design/chapter-II/distributed-transactions/three-phase-commit.png" alt="three-phase-commit" class="img_ev3q"></p><p>Three-phase commit (3PC) is an extension of the two-phase commit where the commit phase is split into two phases. This helps with the blocking problem that occurs in the two-phase commit protocol.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="phases-1">Phases<a href="#phases-1" class="hash-link" aria-label="Phases的直接链接" title="Phases的直接链接">​</a></h4><p>Three-phase commit consists of the following phases:</p><p><strong>Prepare phase</strong></p><p>This phase is the same as the two-phase commit.</p><p><strong>Pre-commit phase</strong></p><p>Coordinator issues the pre-commit message and all the participating nodes must acknowledge it. If a participant fails to receive this message in time, then the transaction is aborted.</p><p><strong>Commit phase</strong></p><p>This step is also similar to the two-phase commit protocol.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="why-is-the-pre-commit-phase-helpful">Why is the Pre-commit phase helpful?<a href="#why-is-the-pre-commit-phase-helpful" class="hash-link" aria-label="Why is the Pre-commit phase helpful?的直接链接" title="Why is the Pre-commit phase helpful?的直接链接">​</a></h4><p>The pre-commit phase accomplishes the following:</p><ul><li>If the participant nodes are found in this phase, that means that <em>every</em> participant has completed the first phase. The completion of prepare phase is guaranteed.</li><li>Every phase can now time out and avoid indefinite waits.</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="sagas">Sagas<a href="#sagas" class="hash-link" aria-label="Sagas的直接链接" title="Sagas的直接链接">​</a></h3><p><img loading="lazy" src="https://raw.githubusercontent.com/karanpratapsingh/portfolio/master/public/static/courses/system-design/chapter-II/distributed-transactions/sagas.png" alt="sagas" class="img_ev3q"></p><p>A saga is a sequence of local transactions. Each local transaction updates the database and publishes a message or event to trigger the next local transaction in the saga. If a local transaction fails because it violates a business rule then the saga executes a series of compensating transactions that undo the changes that were made by the preceding local transactions.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="coordination">Coordination<a href="#coordination" class="hash-link" aria-label="Coordination的直接链接" title="Coordination的直接链接">​</a></h4><p>There are two common implementation approaches:</p><ul><li><strong>Choreography</strong>: Each local transaction publishes domain events that trigger local transactions in other services.</li><li><strong>Orchestration</strong>: An orchestrator tells the participants what local transactions to execute.</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="problems-1">Problems<a href="#problems-1" class="hash-link" aria-label="Problems的直接链接" title="Problems的直接链接">​</a></h4><ul><li>The Saga pattern is particularly hard to debug.</li><li>There&#x27;s a risk of cyclic dependency between saga participants.</li><li>Lack of participant data isolation imposes durability challenges.</li><li>Testing is difficult because all services must be running to simulate a transaction.</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="sharding">Sharding<a href="#sharding" class="hash-link" aria-label="Sharding的直接链接" title="Sharding的直接链接">​</a></h2><p>Before we discuss sharding, let&#x27;s talk about data partitioning:</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="data-partitioning">Data Partitioning<a href="#data-partitioning" class="hash-link" aria-label="Data Partitioning的直接链接" title="Data Partitioning的直接链接">​</a></h3><p>Data partitioning is a technique to break up a database into many smaller parts. It is the process of splitting up a database or a table across multiple machines to improve the manageability, performance, and availability of a database.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="methods">Methods<a href="#methods" class="hash-link" aria-label="Methods的直接链接" title="Methods的直接链接">​</a></h4><p>There are many different ways one could use to decide how to break up an application database into multiple smaller DBs. Below are two of the most popular methods used by various large-scale applications:</p><p><strong>Horizontal Partitioning (or Sharding)</strong></p><p>In this strategy, we split the table data horizontally based on the range of values defined by the <em>partition key</em>. It is also referred to as <strong><em>database sharding</em></strong>.</p><p><strong>Vertical Partitioning</strong></p><p>In vertical partitioning, we partition the data vertically based on columns. We divide tables into relatively smaller tables with few elements, and each part is present in a separate partition.</p><p>In this tutorial, we will specifically focus on sharding.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="what-is-sharding">What is sharding?<a href="#what-is-sharding" class="hash-link" aria-label="What is sharding?的直接链接" title="What is sharding?的直接链接">​</a></h3><p>Sharding is a database architecture pattern related to <em>horizontal partitioning</em>, which is the practice of separating one table&#x27;s rows into multiple different tables, known as <em>partitions</em> or <em>shards</em>. Each partition has the same schema and columns, but also a subset of the shared data. Likewise, the data held in each is unique and independent of the data held in other partitions.</p><p><img loading="lazy" src="https://raw.githubusercontent.com/karanpratapsingh/portfolio/master/public/static/courses/system-design/chapter-II/sharding/sharding.png" alt="sharding" class="img_ev3q"></p><p>The justification for data sharding is that, after a certain point, it is cheaper and more feasible to scale horizontally by adding more machines than to scale it vertically by adding powerful servers. Sharding can be implemented at both application or the database level.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="partitioning-criteria">Partitioning criteria<a href="#partitioning-criteria" class="hash-link" aria-label="Partitioning criteria的直接链接" title="Partitioning criteria的直接链接">​</a></h3><p>There are a large number of criteria available for data partitioning. Some most commonly used criteria are:</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="hash-based">Hash-Based<a href="#hash-based" class="hash-link" aria-label="Hash-Based的直接链接" title="Hash-Based的直接链接">​</a></h4><p>This strategy divides the rows into different partitions based on a hashing algorithm rather than grouping database rows based on continuous indexes.</p><p>The disadvantage of this method is that dynamically adding/removing database servers becomes expensive.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="list-based">List-Based<a href="#list-based" class="hash-link" aria-label="List-Based的直接链接" title="List-Based的直接链接">​</a></h4><p>In list-based partitioning, each partition is defined and selected based on the list of values on a column rather than a set of contiguous ranges of values.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="range-based">Range Based<a href="#range-based" class="hash-link" aria-label="Range Based的直接链接" title="Range Based的直接链接">​</a></h4><p>Range partitioning maps data to various partitions based on ranges of values of the partitioning key. In other words, we partition the table in such a way that each partition contains rows within a given range defined by the partition key.</p><p>Ranges should be contiguous but not overlapping, where each range specifies a non-inclusive lower and upper bound for a partition. Any partitioning key values equal to or higher than the upper bound of the range are added to the next partition.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="composite">Composite<a href="#composite" class="hash-link" aria-label="Composite的直接链接" title="Composite的直接链接">​</a></h4><p>As the name suggests, composite partitioning partitions the data based on two or more partitioning techniques. Here we first partition the data using one technique, and then each partition is further subdivided into sub-partitions using the same or some other method.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="advantages-5">Advantages<a href="#advantages-5" class="hash-link" aria-label="Advantages的直接链接" title="Advantages的直接链接">​</a></h3><p>But why do we need sharding? Here are some advantages:</p><ul><li><strong>Availability</strong>: Provides logical independence to the partitioned database, ensuring the high availability of our application. Here individual partitions can be managed independently.</li><li><strong>Scalability</strong>: Proves to increase scalability by distributing the data across multiple partitions.</li><li><strong>Security</strong>: Helps improve the system&#x27;s security by storing sensitive and non-sensitive data in different partitions. This could provide better manageability and security to sensitive data.</li><li><strong>Query Performance</strong>: Improves the performance of the system. Instead of querying the whole database, now the system has to query only a smaller partition.</li><li><strong>Data Manageability</strong>: Divides tables and indexes into smaller and more manageable units.</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="disadvantages-5">Disadvantages<a href="#disadvantages-5" class="hash-link" aria-label="Disadvantages的直接链接" title="Disadvantages的直接链接">​</a></h3><ul><li><strong>Complexity</strong>: Sharding increases the complexity of the system in general.</li><li><strong>Joins across shards</strong>: Once a database is partitioned and spread across multiple machines it is often not feasible to perform joins that span multiple database shards. Such joins will not be performance efficient since data has to be retrieved from multiple servers.</li><li><strong>Rebalancing</strong>: If the data distribution is not uniform or there is a lot of load on a single shard, in such cases, we have to rebalance our shards so that the requests are as equally distributed among the shards as possible.</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="when-to-use-sharding">When to use sharding?<a href="#when-to-use-sharding" class="hash-link" aria-label="When to use sharding?的直接链接" title="When to use sharding?的直接链接">​</a></h3><p>Here are some reasons why sharding might be the right choice:</p><ul><li>Leveraging existing hardware instead of high-end machines.</li><li>Maintain data in distinct geographic regions.</li><li>Quickly scale by adding more shards.</li><li>Better performance as each machine is under less load.</li><li>When more concurrent connections are required.</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="consistent-hashing">Consistent Hashing<a href="#consistent-hashing" class="hash-link" aria-label="Consistent Hashing的直接链接" title="Consistent Hashing的直接链接">​</a></h2><p>Let&#x27;s first understand the problem we&#x27;re trying to solve.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="why-do-we-need-this">Why do we need this?<a href="#why-do-we-need-this" class="hash-link" aria-label="Why do we need this?的直接链接" title="Why do we need this?的直接链接">​</a></h3><p>In traditional hashing-based distribution methods, we use a hash function to hash our partition keys (i.e. request ID or IP). Then if we use the modulo against the total number of nodes (server or databases). This will give us the node where we want to route our request.</p><p><img loading="lazy" src="https://raw.githubusercontent.com/karanpratapsingh/portfolio/master/public/static/courses/system-design/chapter-II/consistent-hashing/simple-hashing.png" alt="simple-hashing" class="img_ev3q"></p><div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.25em" columnalign="right left" columnspacing="0em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mi>H</mi><mi>a</mi><mi>s</mi><mi>h</mi><mo stretchy="false">(</mo><mi>k</mi><mi>e</mi><msub><mi>y</mi><mn>1</mn></msub><mo stretchy="false">)</mo><mo>→</mo><msub><mi>H</mi><mn>1</mn></msub><mtext> </mtext><mo lspace="0.22em" rspace="0.22em"><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow></mo><mtext> </mtext><mi>N</mi><mo>=</mo><mi>N</mi><mi>o</mi><mi>d</mi><msub><mi>e</mi><mn>0</mn></msub></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mi>H</mi><mi>a</mi><mi>s</mi><mi>h</mi><mo stretchy="false">(</mo><mi>k</mi><mi>e</mi><msub><mi>y</mi><mn>2</mn></msub><mo stretchy="false">)</mo><mo>→</mo><msub><mi>H</mi><mn>2</mn></msub><mtext> </mtext><mo lspace="0.22em" rspace="0.22em"><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow></mo><mtext> </mtext><mi>N</mi><mo>=</mo><mi>N</mi><mi>o</mi><mi>d</mi><msub><mi>e</mi><mn>1</mn></msub></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mi>H</mi><mi>a</mi><mi>s</mi><mi>h</mi><mo stretchy="false">(</mo><mi>k</mi><mi>e</mi><msub><mi>y</mi><mn>3</mn></msub><mo stretchy="false">)</mo><mo>→</mo><msub><mi>H</mi><mn>3</mn></msub><mtext> </mtext><mo lspace="0.22em" rspace="0.22em"><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow></mo><mtext> </mtext><mi>N</mi><mo>=</mo><mi>N</mi><mi>o</mi><mi>d</mi><msub><mi>e</mi><mn>2</mn></msub></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mi>H</mi><mi>a</mi><mi>s</mi><mi>h</mi><mo stretchy="false">(</mo><mi>k</mi><mi>e</mi><msub><mi>y</mi><mi>n</mi></msub><mo stretchy="false">)</mo><mo>→</mo><msub><mi>H</mi><mi>n</mi></msub><mtext> </mtext><mo lspace="0.22em" rspace="0.22em"><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow></mo><mtext> </mtext><mi>N</mi><mo>=</mo><mi>N</mi><mi>o</mi><mi>d</mi><msub><mi>e</mi><mrow><mi>n</mi><mo>−</mo><mn>1</mn></mrow></msub></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{align*} &amp; Hash(key_1) \to H_1 \bmod N = Node_0 \\ &amp; Hash(key_2) \to H_2 \bmod N = Node_1 \\ &amp; Hash(key_3) \to H_3 \bmod N = Node_2 \\ &amp; ... \\ &amp; Hash(key_n) \to H_n \bmod N = Node_{n-1} \end{align*}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:7.5em;vertical-align:-3.5em"></span><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:4em"><span style="top:-6em"><span class="pstrut" style="height:2.84em"></span><span class="mord"></span></span><span style="top:-4.5em"><span class="pstrut" style="height:2.84em"></span><span class="mord"></span></span><span style="top:-3em"><span class="pstrut" style="height:2.84em"></span><span class="mord"></span></span><span style="top:-1.5em"><span class="pstrut" style="height:2.84em"></span><span class="mord"></span></span><span style="top:0em"><span class="pstrut" style="height:2.84em"></span><span class="mord"></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:3.5em"><span></span></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:4em"><span style="top:-6.16em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord"></span><span class="mord mathnormal" style="margin-right:0.08125em">H</span><span class="mord mathnormal">a</span><span class="mord mathnormal">s</span><span class="mord mathnormal">h</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03148em">k</span><span class="mord mathnormal">e</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">→</span><span class="mspace" style="margin-right:0.2778em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.08125em">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em"><span style="top:-2.55em;margin-left:-0.0813em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.0556em"></span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.0556em"></span><span class="mspace" style="margin-right:0.2222em"></span><span class="mord mathnormal" style="margin-right:0.10903em">N</span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span><span class="mord mathnormal" style="margin-right:0.10903em">N</span><span class="mord mathnormal">o</span><span class="mord mathnormal">d</span><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span></span></span><span style="top:-4.66em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord"></span><span class="mord mathnormal" style="margin-right:0.08125em">H</span><span class="mord mathnormal">a</span><span class="mord mathnormal">s</span><span class="mord mathnormal">h</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03148em">k</span><span class="mord mathnormal">e</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">→</span><span class="mspace" style="margin-right:0.2778em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.08125em">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em"><span style="top:-2.55em;margin-left:-0.0813em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.0556em"></span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.0556em"></span><span class="mspace" style="margin-right:0.2222em"></span><span class="mord mathnormal" style="margin-right:0.10903em">N</span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span><span class="mord mathnormal" style="margin-right:0.10903em">N</span><span class="mord mathnormal">o</span><span class="mord mathnormal">d</span><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span></span></span><span style="top:-3.16em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord"></span><span class="mord mathnormal" style="margin-right:0.08125em">H</span><span class="mord mathnormal">a</span><span class="mord mathnormal">s</span><span class="mord mathnormal">h</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03148em">k</span><span class="mord mathnormal">e</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">→</span><span class="mspace" style="margin-right:0.2778em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.08125em">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em"><span style="top:-2.55em;margin-left:-0.0813em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.0556em"></span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.0556em"></span><span class="mspace" style="margin-right:0.2222em"></span><span class="mord mathnormal" style="margin-right:0.10903em">N</span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span><span class="mord mathnormal" style="margin-right:0.10903em">N</span><span class="mord mathnormal">o</span><span class="mord mathnormal">d</span><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span></span></span><span style="top:-1.66em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord"></span><span class="mord">...</span></span></span><span style="top:-0.16em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord"></span><span class="mord mathnormal" style="margin-right:0.08125em">H</span><span class="mord mathnormal">a</span><span class="mord mathnormal">s</span><span class="mord mathnormal">h</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03148em">k</span><span class="mord mathnormal">e</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">→</span><span class="mspace" style="margin-right:0.2778em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.08125em">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em"><span style="top:-2.55em;margin-left:-0.0813em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.0556em"></span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.0556em"></span><span class="mspace" style="margin-right:0.2222em"></span><span class="mord mathnormal" style="margin-right:0.10903em">N</span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span><span class="mord mathnormal" style="margin-right:0.10903em">N</span><span class="mord mathnormal">o</span><span class="mord mathnormal">d</span><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:3.5em"><span></span></span></span></span></span></span></span></span></span></span></span></div><p>Where,</p><p><code>key</code>: Request ID or IP.</p><p><code>H</code>: Hash function result.</p><p><code>N</code>: Total number of nodes.</p><p><code>Node</code>: The node where the request will be routed.</p><p>The problem with this is if we add or remove a node, it will cause <code>N</code> to change, meaning our mapping strategy will break as the same requests will now map to a different server. As a consequence, the majority of requests will need to be redistributed which is very inefficient.</p><p>We want to uniformly distribute requests among different nodes such that we should be able to add or remove nodes with minimal effort. Hence, we need a distribution scheme that does not depend directly on the number of nodes (or servers), so that, when adding or removing nodes, the number of keys that need to be relocated is minimized.</p><p>Consistent hashing solves this horizontal scalability problem by ensuring that every time we scale up or down, we do not have to re-arrange all the keys or touch all the servers.</p><p>Now that we understand the problem, let&#x27;s discuss consistent hashing in detail.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="how-does-it-work">How does it work<a href="#how-does-it-work" class="hash-link" aria-label="How does it work的直接链接" title="How does it work的直接链接">​</a></h3><p>Consistent Hashing is a distributed hashing scheme that operates independently of the number of nodes in a distributed hash table by assigning them a position on an abstract circle, or hash ring. This allows servers and objects to scale without affecting the overall system.</p><p><img loading="lazy" src="https://raw.githubusercontent.com/karanpratapsingh/portfolio/master/public/static/courses/system-design/chapter-II/consistent-hashing/consistent-hashing.png" alt="consistent-hashing" class="img_ev3q"></p><p>Using consistent hashing, only <code>K/N</code> data would require re-distributing.</p><div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>R</mi><mo>=</mo><mi>K</mi><mi mathvariant="normal">/</mi><mi>N</mi></mrow><annotation encoding="application/x-tex">R = K/N</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em"></span><span class="mord mathnormal" style="margin-right:0.00773em">R</span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord mathnormal" style="margin-right:0.07153em">K</span><span class="mord">/</span><span class="mord mathnormal" style="margin-right:0.10903em">N</span></span></span></span></span></div><p>Where,</p><p><code>R</code>: Data that would require re-distribution.</p><p><code>K</code>: Number of partition keys.</p><p><code>N</code>: Number of nodes.</p><p>The output of the hash function is a range let&#x27;s say <code>0...m-1</code> which we can represent on our hash ring. We hash the requests and distribute them on the ring depending on what the output was. Similarly, we also hash the node and distribute them on the same ring as well.</p><div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.25em" columnalign="right left" columnspacing="0em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mi>H</mi><mi>a</mi><mi>s</mi><mi>h</mi><mo stretchy="false">(</mo><mi>k</mi><mi>e</mi><msub><mi>y</mi><mn>1</mn></msub><mo stretchy="false">)</mo><mo>=</mo><msub><mi>P</mi><mn>1</mn></msub></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mi>H</mi><mi>a</mi><mi>s</mi><mi>h</mi><mo stretchy="false">(</mo><mi>k</mi><mi>e</mi><msub><mi>y</mi><mn>2</mn></msub><mo stretchy="false">)</mo><mo>=</mo><msub><mi>P</mi><mn>2</mn></msub></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mi>H</mi><mi>a</mi><mi>s</mi><mi>h</mi><mo stretchy="false">(</mo><mi>k</mi><mi>e</mi><msub><mi>y</mi><mn>3</mn></msub><mo stretchy="false">)</mo><mo>=</mo><msub><mi>P</mi><mn>3</mn></msub></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mi>H</mi><mi>a</mi><mi>s</mi><mi>h</mi><mo stretchy="false">(</mo><mi>k</mi><mi>e</mi><msub><mi>y</mi><mi>n</mi></msub><mo stretchy="false">)</mo><mo>=</mo><msub><mi>P</mi><mrow><mi>m</mi><mo>−</mo><mn>1</mn></mrow></msub></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{align*} &amp; Hash(key_1) = P_1 \\ &amp; Hash(key_2) = P_2 \\ &amp; Hash(key_3) = P_3 \\ &amp; ... \\ &amp; Hash(key_n) = P_{m-1} \end{align*}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:7.5em;vertical-align:-3.5em"></span><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:4em"><span style="top:-6em"><span class="pstrut" style="height:2.84em"></span><span class="mord"></span></span><span style="top:-4.5em"><span class="pstrut" style="height:2.84em"></span><span class="mord"></span></span><span style="top:-3em"><span class="pstrut" style="height:2.84em"></span><span class="mord"></span></span><span style="top:-1.5em"><span class="pstrut" style="height:2.84em"></span><span class="mord"></span></span><span style="top:0em"><span class="pstrut" style="height:2.84em"></span><span class="mord"></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:3.5em"><span></span></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:4em"><span style="top:-6.16em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord"></span><span class="mord mathnormal" style="margin-right:0.08125em">H</span><span class="mord mathnormal">a</span><span class="mord mathnormal">s</span><span class="mord mathnormal">h</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03148em">k</span><span class="mord mathnormal">e</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span></span></span><span style="top:-4.66em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord"></span><span class="mord mathnormal" style="margin-right:0.08125em">H</span><span class="mord mathnormal">a</span><span class="mord mathnormal">s</span><span class="mord mathnormal">h</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03148em">k</span><span class="mord mathnormal">e</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span></span></span><span style="top:-3.16em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord"></span><span class="mord mathnormal" style="margin-right:0.08125em">H</span><span class="mord mathnormal">a</span><span class="mord mathnormal">s</span><span class="mord mathnormal">h</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03148em">k</span><span class="mord mathnormal">e</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span></span></span><span style="top:-1.66em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord"></span><span class="mord">...</span></span></span><span style="top:-0.16em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord"></span><span class="mord mathnormal" style="margin-right:0.08125em">H</span><span class="mord mathnormal">a</span><span class="mord mathnormal">s</span><span class="mord mathnormal">h</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03148em">k</span><span class="mord mathnormal">e</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">m</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:3.5em"><span></span></span></span></span></span></span></span></span></span></span></span></div><p>Where,</p><p><code>key</code>: Request/Node ID or IP.</p><p><code>P</code>: Position on the hash ring.</p><p><code>m</code>: Total range of the hash ring.</p><p>Now, when the request comes in we can simply route it to the closest node in a clockwise (can be counterclockwise as well) manner. This means that if a new node is added or removed, we can use the nearest node and only a <em>fraction</em> of the requests need to be re-routed.</p><p>In theory, consistent hashing should distribute the load evenly however it doesn&#x27;t happen in practice. Usually, the load distribution is uneven and one server may end up handling the majority of the request becoming a <em>hotspot</em>, essentially a bottleneck for the system. We can fix this by adding extra nodes but that can be expensive.</p><p>Let&#x27;s see how we can address these issues.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="virtual-nodes">Virtual Nodes<a href="#virtual-nodes" class="hash-link" aria-label="Virtual Nodes的直接链接" title="Virtual Nodes的直接链接">​</a></h3><p>In order to ensure a more evenly distributed load, we can introduce the idea of a virtual node, sometimes also referred to as a VNode.</p><p>Instead of assigning a single position to a node, the hash range is divided into multiple smaller ranges, and each physical node is assigned several of these smaller ranges. Each of these subranges is considered a VNode. Hence, virtual nodes are basically existing physical nodes mapped multiple times across the hash ring to minimize changes to a node&#x27;s assigned range.</p><p><img loading="lazy" src="https://raw.githubusercontent.com/karanpratapsingh/portfolio/master/public/static/courses/system-design/chapter-II/consistent-hashing/virtual-nodes.png" alt="virtual-nodes" class="img_ev3q"></p><p>For this, we can use <code>k</code> number of hash functions.</p><div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.25em" columnalign="right left" columnspacing="0em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mi>H</mi><mi>a</mi><mi>s</mi><msub><mi>h</mi><mn>1</mn></msub><mo stretchy="false">(</mo><mi>k</mi><mi>e</mi><msub><mi>y</mi><mn>1</mn></msub><mo stretchy="false">)</mo><mo>=</mo><msub><mi>P</mi><mn>1</mn></msub></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mi>H</mi><mi>a</mi><mi>s</mi><msub><mi>h</mi><mn>2</mn></msub><mo stretchy="false">(</mo><mi>k</mi><mi>e</mi><msub><mi>y</mi><mn>2</mn></msub><mo stretchy="false">)</mo><mo>=</mo><msub><mi>P</mi><mn>2</mn></msub></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mi>H</mi><mi>a</mi><mi>s</mi><msub><mi>h</mi><mn>3</mn></msub><mo stretchy="false">(</mo><mi>k</mi><mi>e</mi><msub><mi>y</mi><mn>3</mn></msub><mo stretchy="false">)</mo><mo>=</mo><msub><mi>P</mi><mn>3</mn></msub></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mi>H</mi><mi>a</mi><mi>s</mi><msub><mi>h</mi><mi>k</mi></msub><mo stretchy="false">(</mo><mi>k</mi><mi>e</mi><msub><mi>y</mi><mi>n</mi></msub><mo stretchy="false">)</mo><mo>=</mo><msub><mi>P</mi><mrow><mi>m</mi><mo>−</mo><mn>1</mn></mrow></msub></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{align*} &amp; Hash_1(key_1) = P_1 \\ &amp; Hash_2(key_2) = P_2 \\ &amp; Hash_3(key_3) = P_3 \\ &amp; . . . \\ &amp; Hash_k(key_n) = P_{m-1} \end{align*}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:7.5em;vertical-align:-3.5em"></span><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:4em"><span style="top:-6em"><span class="pstrut" style="height:2.84em"></span><span class="mord"></span></span><span style="top:-4.5em"><span class="pstrut" style="height:2.84em"></span><span class="mord"></span></span><span style="top:-3em"><span class="pstrut" style="height:2.84em"></span><span class="mord"></span></span><span style="top:-1.5em"><span class="pstrut" style="height:2.84em"></span><span class="mord"></span></span><span style="top:0em"><span class="pstrut" style="height:2.84em"></span><span class="mord"></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:3.5em"><span></span></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:4em"><span style="top:-6.16em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord"></span><span class="mord mathnormal" style="margin-right:0.08125em">H</span><span class="mord mathnormal">a</span><span class="mord mathnormal">s</span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03148em">k</span><span class="mord mathnormal">e</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span></span></span><span style="top:-4.66em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord"></span><span class="mord mathnormal" style="margin-right:0.08125em">H</span><span class="mord mathnormal">a</span><span class="mord mathnormal">s</span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03148em">k</span><span class="mord mathnormal">e</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span></span></span><span style="top:-3.16em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord"></span><span class="mord mathnormal" style="margin-right:0.08125em">H</span><span class="mord mathnormal">a</span><span class="mord mathnormal">s</span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03148em">k</span><span class="mord mathnormal">e</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span></span></span><span style="top:-1.66em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord"></span><span class="mord">...</span></span></span><span style="top:-0.16em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord"></span><span class="mord mathnormal" style="margin-right:0.08125em">H</span><span class="mord mathnormal">a</span><span class="mord mathnormal">s</span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03148em">k</span><span class="mord mathnormal">e</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">m</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:3.5em"><span></span></span></span></span></span></span></span></span></span></span></span></div><p>Where,</p><p><code>key</code>: Request/Node ID or IP.</p><p><code>k</code>: Number of hash functions.</p><p><code>P</code>: Position on the hash ring.</p><p><code>m</code>: Total range of the hash ring.</p><p>As VNodes help spread the load more evenly across the physical nodes on the cluster by diving the hash ranges into smaller subranges, this speeds up the re-balancing process after adding or removing nodes. This also helps us reduce the probability of hotspots.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="data-replication">Data Replication<a href="#data-replication" class="hash-link" aria-label="Data Replication的直接链接" title="Data Replication的直接链接">​</a></h3><p>To ensure high availability and durability, consistent hashing replicates each data item on multiple <code>N</code> nodes in the system where the value <code>N</code> is equivalent to the <em>replication factor</em>.</p><p>The replication factor is the number of nodes that will receive the copy of the same data. In eventually consistent systems, this is done asynchronously.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="advantages-6">Advantages<a href="#advantages-6" class="hash-link" aria-label="Advantages的直接链接" title="Advantages的直接链接">​</a></h3><p>Let&#x27;s look at some advantages of consistent hashing:</p><ul><li>Makes rapid scaling up and down more predictable.</li><li>Facilitates partitioning and replication across nodes.</li><li>Enables scalability and availability.</li><li>Reduces hotspots.</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="disadvantages-6">Disadvantages<a href="#disadvantages-6" class="hash-link" aria-label="Disadvantages的直接链接" title="Disadvantages的直接链接">​</a></h3><p>Below are some disadvantages of consistent hashing:</p><ul><li>Increases complexity.</li><li>Cascading failures.</li><li>Load distribution can still be uneven.</li><li>Key management can be expensive when nodes transiently fail.</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="examples-1">Examples<a href="#examples-1" class="hash-link" aria-label="Examples的直接链接" title="Examples的直接链接">​</a></h3><p>Let&#x27;s look at some examples where consistent hashing is used:</p><ul><li>Data partitioning in <a href="https://cassandra.apache.org" target="_blank" rel="noopener noreferrer">Apache Cassandra</a>.</li><li>Load distribution across multiple storage hosts in <a href="https://aws.amazon.com/dynamodb" target="_blank" rel="noopener noreferrer">Amazon DynamoDB</a>.</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="database-federation">Database Federation<a href="#database-federation" class="hash-link" aria-label="Database Federation的直接链接" title="Database Federation的直接链接">​</a></h2><p>Federation (or functional partitioning) splits up databases by function. The federation architecture makes several distinct physical databases appear as one logical database to end-users.</p><p>All of the components in a federation are tied together by one or more federal schemas that express the commonality of data throughout the federation. These federated schemas are used to specify the information that can be shared by the federation components and to provide a common basis for communication among them.</p><p><img loading="lazy" src="https://raw.githubusercontent.com/karanpratapsingh/portfolio/master/public/static/courses/system-design/chapter-II/database-federation/database-federation.png" alt="database-federation" class="img_ev3q"></p><p>Federation also provides a cohesive, unified view of data derived from multiple sources. The data sources for federated systems can include databases and various other forms of structured and unstructured data.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="characteristics">Characteristics<a href="#characteristics" class="hash-link" aria-label="Characteristics的直接链接" title="Characteristics的直接链接">​</a></h3><p>Let&#x27;s look at some key characteristics of a federated database:</p><ul><li><strong>Transparency</strong>: Federated database masks user differences and implementations of underlying data sources. Therefore, the users do not need to be aware of where the data is stored.</li><li><strong>Heterogeneity</strong>: Data sources can differ in many ways. A federated database system can handle different hardware, network protocols, data models, etc.</li><li><strong>Extensibility</strong>: New sources may be needed to meet the changing needs of the business. A good federated database system needs to make it easy to add new sources.</li><li><strong>Autonomy</strong>: A Federated database does not change existing data sources, interfaces should remain the same.</li><li><strong>Data integration</strong>: A federated database can integrate data from different protocols, database management systems, etc.</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="advantages-7">Advantages<a href="#advantages-7" class="hash-link" aria-label="Advantages的直接链接" title="Advantages的直接链接">​</a></h3><p>Here are some advantages of federated databases:</p><ul><li>Flexible data sharing.</li><li>Autonomy among the database components.</li><li>Access heterogeneous data in a unified way.</li><li>No tight coupling of applications with legacy databases.</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="disadvantages-7">Disadvantages<a href="#disadvantages-7" class="hash-link" aria-label="Disadvantages的直接链接" title="Disadvantages的直接链接">​</a></h3><p>Below are some disadvantages of federated databases:</p><ul><li>Adds more hardware and additional complexity.</li><li>Joining data from two databases is complex.</li><li>Dependence on autonomous data sources.</li><li>Query performance and scalability.</li></ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/imwito/imwito.github.io/tree/main/docs/system-design/chapter2.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>编辑此页</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="文件选项卡"><a class="pagination-nav__link pagination-nav__link--prev" href="/zh-Hans/docs/system-design/chapter1"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">Chapter 1</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/zh-Hans/docs/system-design/chapter3"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">Chapter 3</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#databases-and-dbms" class="table-of-contents__link toc-highlight">Databases and DBMS</a><ul><li><a href="#what-is-a-database" class="table-of-contents__link toc-highlight">What is a Database?</a></li><li><a href="#what-is-dbms" class="table-of-contents__link toc-highlight">What is DBMS?</a></li><li><a href="#components" class="table-of-contents__link toc-highlight">Components</a></li><li><a href="#types" class="table-of-contents__link toc-highlight">Types</a></li><li><a href="#challenges" class="table-of-contents__link toc-highlight">Challenges</a></li></ul></li><li><a href="#sql-databases" class="table-of-contents__link toc-highlight">SQL databases</a><ul><li><a href="#materialized-views" class="table-of-contents__link toc-highlight">Materialized views</a></li><li><a href="#n1-query-problem" class="table-of-contents__link toc-highlight">N+1 query problem</a></li><li><a href="#advantages" class="table-of-contents__link toc-highlight">Advantages</a></li><li><a href="#disadvantages" class="table-of-contents__link toc-highlight">Disadvantages</a></li><li><a href="#examples" class="table-of-contents__link toc-highlight">Examples</a></li></ul></li><li><a href="#nosql-databases" class="table-of-contents__link toc-highlight">NoSQL databases</a></li><li><a href="#sql-vs-nosql-databases" class="table-of-contents__link toc-highlight">SQL vs NoSQL databases</a><ul><li><a href="#high-level-differences" class="table-of-contents__link toc-highlight">High-level differences</a></li><li><a href="#reasons" class="table-of-contents__link toc-highlight">Reasons</a></li></ul></li><li><a href="#database-replication" class="table-of-contents__link toc-highlight">Database Replication</a><ul><li><a href="#master-slave-replication" class="table-of-contents__link toc-highlight">Master-Slave Replication</a></li><li><a href="#master-master-replication" class="table-of-contents__link toc-highlight">Master-Master Replication</a></li><li><a href="#synchronous-vs-asynchronous-replication" class="table-of-contents__link toc-highlight">Synchronous vs Asynchronous replication</a></li></ul></li><li><a href="#indexes" class="table-of-contents__link toc-highlight">Indexes</a><ul><li><a href="#dense-index" class="table-of-contents__link toc-highlight">Dense Index</a></li><li><a href="#sparse-index" class="table-of-contents__link toc-highlight">Sparse Index</a></li></ul></li><li><a href="#normalization-and-denormalization" class="table-of-contents__link toc-highlight">Normalization and Denormalization</a><ul><li><a href="#terms" class="table-of-contents__link toc-highlight">Terms</a></li><li><a href="#normalization" class="table-of-contents__link toc-highlight">Normalization</a></li><li><a href="#denormalization" class="table-of-contents__link toc-highlight">Denormalization</a></li></ul></li><li><a href="#acid-and-base-consistency-models" class="table-of-contents__link toc-highlight">ACID and BASE consistency models</a><ul><li><a href="#acid" class="table-of-contents__link toc-highlight">ACID</a></li><li><a href="#base" class="table-of-contents__link toc-highlight">BASE</a></li><li><a href="#acid-vs-base-trade-offs" class="table-of-contents__link toc-highlight">ACID vs BASE Trade-offs</a></li></ul></li><li><a href="#cap-theorem" class="table-of-contents__link toc-highlight">CAP Theorem</a><ul><li><a href="#consistency-availability-tradeoff" class="table-of-contents__link toc-highlight">Consistency-Availability Tradeoff</a></li></ul></li><li><a href="#pacelc-theorem" class="table-of-contents__link toc-highlight">PACELC Theorem</a></li><li><a href="#transactions" class="table-of-contents__link toc-highlight">Transactions</a><ul><li><a href="#states" class="table-of-contents__link toc-highlight">States</a></li></ul></li><li><a href="#distributed-transactions" class="table-of-contents__link toc-highlight">Distributed Transactions</a><ul><li><a href="#why-do-we-need-distributed-transactions" class="table-of-contents__link toc-highlight">Why do we need distributed transactions?</a></li><li><a href="#two-phase-commit" class="table-of-contents__link toc-highlight">Two-Phase commit</a></li><li><a href="#three-phase-commit" class="table-of-contents__link toc-highlight">Three-phase commit</a></li><li><a href="#sagas" class="table-of-contents__link toc-highlight">Sagas</a></li></ul></li><li><a href="#sharding" class="table-of-contents__link toc-highlight">Sharding</a><ul><li><a href="#data-partitioning" class="table-of-contents__link toc-highlight">Data Partitioning</a></li><li><a href="#what-is-sharding" class="table-of-contents__link toc-highlight">What is sharding?</a></li><li><a href="#partitioning-criteria" class="table-of-contents__link toc-highlight">Partitioning criteria</a></li><li><a href="#advantages-5" class="table-of-contents__link toc-highlight">Advantages</a></li><li><a href="#disadvantages-5" class="table-of-contents__link toc-highlight">Disadvantages</a></li><li><a href="#when-to-use-sharding" class="table-of-contents__link toc-highlight">When to use sharding?</a></li></ul></li><li><a href="#consistent-hashing" class="table-of-contents__link toc-highlight">Consistent Hashing</a><ul><li><a href="#why-do-we-need-this" class="table-of-contents__link toc-highlight">Why do we need this?</a></li><li><a href="#how-does-it-work" class="table-of-contents__link toc-highlight">How does it work</a></li><li><a href="#virtual-nodes" class="table-of-contents__link toc-highlight">Virtual Nodes</a></li><li><a href="#data-replication" class="table-of-contents__link toc-highlight">Data Replication</a></li><li><a href="#advantages-6" class="table-of-contents__link toc-highlight">Advantages</a></li><li><a href="#disadvantages-6" class="table-of-contents__link toc-highlight">Disadvantages</a></li><li><a href="#examples-1" class="table-of-contents__link toc-highlight">Examples</a></li></ul></li><li><a href="#database-federation" class="table-of-contents__link toc-highlight">Database Federation</a><ul><li><a href="#characteristics" class="table-of-contents__link toc-highlight">Characteristics</a></li><li><a href="#advantages-7" class="table-of-contents__link toc-highlight">Advantages</a></li><li><a href="#disadvantages-7" class="table-of-contents__link toc-highlight">Disadvantages</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 imwito, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/zh-Hans/assets/js/runtime~main.c214fdea.js"></script>
<script src="/zh-Hans/assets/js/main.c22237af.js"></script>
</body>
</html>