<!doctype html>
<html lang="zh-Hans" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-system-design/chapter4" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.3">
<title data-rh="true">Chapter 4 | My Site</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://imwito.github.io/zh-Hans/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://imwito.github.io/zh-Hans/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://imwito.github.io/zh-Hans/docs/system-design/chapter4"><meta data-rh="true" name="docusaurus_locale" content="zh-Hans"><meta data-rh="true" name="docsearch:language" content="zh-Hans"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Chapter 4 | My Site"><meta data-rh="true" name="description" content="Geohashing and Quadtrees"><meta data-rh="true" property="og:description" content="Geohashing and Quadtrees"><link data-rh="true" rel="icon" href="/zh-Hans/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://imwito.github.io/zh-Hans/docs/system-design/chapter4"><link data-rh="true" rel="alternate" href="https://imwito.github.io/docs/system-design/chapter4" hreflang="en"><link data-rh="true" rel="alternate" href="https://imwito.github.io/zh-Hans/docs/system-design/chapter4" hreflang="zh-Hans"><link data-rh="true" rel="alternate" href="https://imwito.github.io/docs/system-design/chapter4" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/zh-Hans/blog/rss.xml" title="My Site RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/zh-Hans/blog/atom.xml" title="My Site Atom Feed">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.24/dist/katex.min.css" integrity="sha384-odtC+0UGzzFL/6PNoE8rX/SPcQDXBJ+uRepguP4QkPCm2LBxH3FA3y+fKSiJ+AmM" crossorigin="anonymous"><link rel="stylesheet" href="/zh-Hans/assets/css/styles.466a89db.css">
<link rel="preload" href="/zh-Hans/assets/js/runtime~main.c214fdea.js" as="script">
<link rel="preload" href="/zh-Hans/assets/js/main.c22237af.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="跳到主要内容"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">跳到主要内容</a></div><nav aria-label="主导航" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/zh-Hans/"><div class="navbar__logo"><img src="/zh-Hans/img/logo.svg" alt="My Site Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/zh-Hans/img/logo.svg" alt="My Site Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">My Site</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/zh-Hans/docs/intro">Tutorial</a><a class="navbar__item navbar__link" href="/zh-Hans/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/imwito/imwito.github.io" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>简体中文</a><ul class="dropdown__menu"><li><a href="/docs/system-design/chapter4" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="en">English</a></li><li><a href="/zh-Hans/docs/system-design/chapter4" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="zh-Hans">简体中文</a></li></ul></div><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="切换浅色/暗黑模式（当前为浅色模式）" aria-label="切换浅色/暗黑模式（当前为浅色模式）" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="文档侧边栏" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/zh-Hans/docs/intro">Tutorial Intro</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/zh-Hans/docs/category/system-design">System Design</a><button aria-label="打开/收起侧边栏菜单「System Design」" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-Hans/docs/system-design/intro">Intro</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-Hans/docs/system-design/chapter1">Chapter 1</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-Hans/docs/system-design/chapter2">Chapter 2</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-Hans/docs/system-design/chapter3">Chapter 3</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/zh-Hans/docs/system-design/chapter4">Chapter 4</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-Hans/docs/system-design/chapter5">Chapter 5</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/zh-Hans/docs/category/tutorial---basics">Tutorial - Basics</a><button aria-label="打开/收起侧边栏菜单「Tutorial - Basics」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/zh-Hans/docs/category/tutorial---extras">Tutorial - Extras</a><button aria-label="打开/收起侧边栏菜单「Tutorial - Extras」" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav><button type="button" title="收起侧边栏" aria-label="收起侧边栏" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="页面路径"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="主页面" class="breadcrumbs__link" href="/zh-Hans/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/zh-Hans/docs/category/system-design"><span itemprop="name">System Design</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Chapter 4</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">本页总览</button></div><div class="theme-doc-markdown markdown"><h1>Chapter 4</h1><h2 class="anchor anchorWithStickyNavbar_LWe7" id="geohashing-and-quadtrees">Geohashing and Quadtrees<a href="#geohashing-and-quadtrees" class="hash-link" aria-label="Geohashing and Quadtrees的直接链接" title="Geohashing and Quadtrees的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="geohashing">Geohashing<a href="#geohashing" class="hash-link" aria-label="Geohashing的直接链接" title="Geohashing的直接链接">​</a></h3><p>Geohashing is a <a href="https://en.wikipedia.org/wiki/Address_geocoding" target="_blank" rel="noopener noreferrer">geocoding</a> method used to encode geographic coordinates such as latitude and longitude into short alphanumeric strings. It was created by <a href="https://twitter.com/gniemeyer" target="_blank" rel="noopener noreferrer">Gustavo Niemeyer</a> in 2008.</p><p>For example, San Francisco with coordinates <code>37.7564, -122.4016</code> can be represented in geohash as <code>9q8yy9mf</code>.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="how-does-geohashing-work">How does Geohashing work?<a href="#how-does-geohashing-work" class="hash-link" aria-label="How does Geohashing work?的直接链接" title="How does Geohashing work?的直接链接">​</a></h4><p>Geohash is a hierarchical spatial index that uses Base-32 alphabet encoding, the first character in a geohash identifies the initial location as one of the 32 cells. This cell will also contain 32 cells. This means that to represent a point, the world is recursively divided into smaller and smaller cells with each additional bit until the desired precision is attained. The precision factor also determines the size of the cell.</p><p><img loading="lazy" src="https://raw.githubusercontent.com/karanpratapsingh/portfolio/master/public/static/courses/system-design/chapter-IV/geohashing-and-quadtrees/geohashing.png" alt="geohashing" class="img_ev3q"></p><p>Geohashing guarantees that points are spatially closer if their Geohashes share a longer prefix which means the more characters in the string, the more precise the location. For example, geohashes <code>9q8yy9mf</code> and <code>9q8yy9vx</code> are spatially closer as they share the prefix <code>9q8yy9</code>.</p><p>Geohashing can also be used to provide a degree of anonymity as we don&#x27;t need to expose the exact location of the user because depending on the length of the geohash we just know they are somewhere within an area.</p><p>The cell sizes of the geohashes of different lengths are as follows:</p><table><thead><tr><th>Geohash length</th><th>Cell width</th><th>Cell height</th></tr></thead><tbody><tr><td>1</td><td>5000 km</td><td>5000 km</td></tr><tr><td>2</td><td>1250 km</td><td>1250 km</td></tr><tr><td>3</td><td>156 km</td><td>156 km</td></tr><tr><td>4</td><td>39.1 km</td><td>19.5 km</td></tr><tr><td>5</td><td>4.89 km</td><td>4.89 km</td></tr><tr><td>6</td><td>1.22 km</td><td>0.61 km</td></tr><tr><td>7</td><td>153 m</td><td>153 m</td></tr><tr><td>8</td><td>38.2 m</td><td>19.1 m</td></tr><tr><td>9</td><td>4.77 m</td><td>4.77 m</td></tr><tr><td>10</td><td>1.19 m</td><td>0.596 m</td></tr><tr><td>11</td><td>149 mm</td><td>149 mm</td></tr><tr><td>12</td><td>37.2 mm</td><td>18.6 mm</td></tr></tbody></table><h4 class="anchor anchorWithStickyNavbar_LWe7" id="use-cases">Use cases<a href="#use-cases" class="hash-link" aria-label="Use cases的直接链接" title="Use cases的直接链接">​</a></h4><p>Here are some common use cases for Geohashing:</p><ul><li>It is a simple way to represent and store a location in a database.</li><li>It can also be shared on social media as URLs since it is easier to share, and remember than latitudes and longitudes.</li><li>We can efficiently find the nearest neighbors of a point through very simple string comparisons and efficient searching of indexes.</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="examples">Examples<a href="#examples" class="hash-link" aria-label="Examples的直接链接" title="Examples的直接链接">​</a></h4><p>Geohashing is widely used and it is supported by popular databases.</p><ul><li><a href="https://www.mysql.com" target="_blank" rel="noopener noreferrer">MySQL</a></li><li><a href="http://redis.io" target="_blank" rel="noopener noreferrer">Redis</a></li><li><a href="https://aws.amazon.com/dynamodb" target="_blank" rel="noopener noreferrer">Amazon DynamoDB</a></li><li><a href="https://cloud.google.com/firestore" target="_blank" rel="noopener noreferrer">Google Cloud Firestore</a></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="quadtrees">Quadtrees<a href="#quadtrees" class="hash-link" aria-label="Quadtrees的直接链接" title="Quadtrees的直接链接">​</a></h3><p>A quadtree is a tree data structure in which each internal node has exactly four children. They are often used to partition a two-dimensional space by recursively subdividing it into four quadrants or regions. Each child or leaf node stores spatial information. Quadtrees are the two-dimensional analog of <a href="https://en.wikipedia.org/wiki/Octree" target="_blank" rel="noopener noreferrer">Octrees</a> which are used to partition three-dimensional space.</p><p><img loading="lazy" src="https://raw.githubusercontent.com/karanpratapsingh/portfolio/master/public/static/courses/system-design/chapter-IV/geohashing-and-quadtrees/quadtree.png" alt="quadtree" class="img_ev3q"></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="types-of-quadtrees">Types of Quadtrees<a href="#types-of-quadtrees" class="hash-link" aria-label="Types of Quadtrees的直接链接" title="Types of Quadtrees的直接链接">​</a></h4><p>Quadtrees may be classified according to the type of data they represent, including areas, points, lines, and curves. The following are common types of quadtrees:</p><ul><li>Point quadtrees</li><li>Point-region (PR) quadtrees</li><li>Polygonal map (PM) quadtrees</li><li>Compressed quadtrees</li><li>Edge quadtrees</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="why-do-we-need-quadtrees">Why do we need Quadtrees?<a href="#why-do-we-need-quadtrees" class="hash-link" aria-label="Why do we need Quadtrees?的直接链接" title="Why do we need Quadtrees?的直接链接">​</a></h4><p>Aren&#x27;t latitudes and longitudes enough? Why do we need quadtrees? While in theory using latitude and longitude we can determine things such as how close points are to each other using <a href="https://en.wikipedia.org/wiki/Euclidean_distance" target="_blank" rel="noopener noreferrer">euclidean distance</a>, for practical use cases it is simply not scalable because of its CPU-intensive nature with large data sets.</p><p><img loading="lazy" src="https://raw.githubusercontent.com/karanpratapsingh/portfolio/master/public/static/courses/system-design/chapter-IV/geohashing-and-quadtrees/quadtree-subdivision.png" alt="quadtree-subdivision" class="img_ev3q"></p><p>Quadtrees enable us to search points within a two-dimensional range efficiently, where those points are defined as latitude/longitude coordinates or as cartesian (x, y) coordinates. Additionally, we can save further computation by only subdividing a node after a certain threshold. And with the application of mapping algorithms such as the <a href="https://en.wikipedia.org/wiki/Hilbert_curve" target="_blank" rel="noopener noreferrer">Hilbert curve</a>, we can easily improve range query performance.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="use-cases-1">Use cases<a href="#use-cases-1" class="hash-link" aria-label="Use cases的直接链接" title="Use cases的直接链接">​</a></h4><p>Below are some common uses of quadtrees:</p><ul><li>Image representation, processing, and compression.</li><li>Spacial indexing and range queries.</li><li>Location-based services like Google Maps, Uber, etc.</li><li>Mesh generation and computer graphics.</li><li>Sparse data storage.</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="circuit-breaker">Circuit breaker<a href="#circuit-breaker" class="hash-link" aria-label="Circuit breaker的直接链接" title="Circuit breaker的直接链接">​</a></h2><p>The circuit breaker is a design pattern used to detect failures and encapsulates the logic of preventing a failure from constantly recurring during maintenance, temporary external system failure, or unexpected system difficulties.</p><p><img loading="lazy" src="https://raw.githubusercontent.com/karanpratapsingh/portfolio/master/public/static/courses/system-design/chapter-IV/circuit-breaker/circuit-breaker.png" alt="circuit-breaker" class="img_ev3q"></p><p>The basic idea behind the circuit breaker is very simple. We wrap a protected function call in a circuit breaker object, which monitors for failures. Once the failures reach a certain threshold, the circuit breaker trips, and all further calls to the circuit breaker return with an error, without the protected call being made at all. Usually, we&#x27;ll also want some kind of monitor alert if the circuit breaker trips.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="why-do-we-need-circuit-breaking">Why do we need circuit breaking?<a href="#why-do-we-need-circuit-breaking" class="hash-link" aria-label="Why do we need circuit breaking?的直接链接" title="Why do we need circuit breaking?的直接链接">​</a></h3><p>It&#x27;s common for software systems to make remote calls to software running in different processes, probably on different machines across a network. One of the big differences between in-memory calls and remote calls is that remote calls can fail, or hang without a response until some timeout limit is reached. What&#x27;s worse is if we have many callers on an unresponsive supplier, then we can run out of critical resources leading to cascading failures across multiple systems.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="states">States<a href="#states" class="hash-link" aria-label="States的直接链接" title="States的直接链接">​</a></h3><p>Let&#x27;s discuss circuit breaker states:</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="closed">Closed<a href="#closed" class="hash-link" aria-label="Closed的直接链接" title="Closed的直接链接">​</a></h4><p>When everything is normal, the circuit breakers remain closed, and all the request passes through to the services as normal. If the number of failures increases beyond the threshold, the circuit breaker trips and goes into an open state.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="open">Open<a href="#open" class="hash-link" aria-label="Open的直接链接" title="Open的直接链接">​</a></h4><p>In this state circuit breaker returns an error immediately without even invoking the services. The Circuit breakers move into the half-open state after a certain timeout period elapses. Usually, it will have a monitoring system where the timeout will be specified.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="half-open">Half-open<a href="#half-open" class="hash-link" aria-label="Half-open的直接链接" title="Half-open的直接链接">​</a></h4><p>In this state, the circuit breaker allows a limited number of requests from the service to pass through and invoke the operation. If the requests are successful, then the circuit breaker will go to the closed state. However, if the requests continue to fail, then it goes back to the open state.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="rate-limiting">Rate Limiting<a href="#rate-limiting" class="hash-link" aria-label="Rate Limiting的直接链接" title="Rate Limiting的直接链接">​</a></h2><p>Rate limiting refers to preventing the frequency of an operation from exceeding a defined limit. In large-scale systems, rate limiting is commonly used to protect underlying services and resources. Rate limiting is generally used as a defensive mechanism in distributed systems, so that shared resources can maintain availability. It also protects our APIs from unintended or malicious overuse by limiting the number of requests that can reach our API in a given period of time.</p><p><img loading="lazy" src="https://raw.githubusercontent.com/karanpratapsingh/portfolio/master/public/static/courses/system-design/chapter-IV/rate-limiting/rate-limiting.png" alt="rate-limiting" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="why-do-we-need-rate-limiting">Why do we need Rate Limiting?<a href="#why-do-we-need-rate-limiting" class="hash-link" aria-label="Why do we need Rate Limiting?的直接链接" title="Why do we need Rate Limiting?的直接链接">​</a></h3><p>Rate limiting is a very important part of any large-scale system and it can be used to accomplish the following:</p><ul><li>Avoid resource starvation as a result of Denial of Service (DoS) attacks.</li><li>Rate Limiting helps in controlling operational costs by putting a virtual cap on the auto-scaling of resources which if not monitored might lead to exponential bills.</li><li>Rate limiting can be used as defense or mitigation against some common attacks.</li><li>For APIs that process massive amounts of data, rate limiting can be used to control the flow of that data.</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="algorithms">Algorithms<a href="#algorithms" class="hash-link" aria-label="Algorithms的直接链接" title="Algorithms的直接链接">​</a></h3><p>There are various algorithms for API rate limiting, each with its advantages and disadvantages. Let&#x27;s briefly discuss some of these algorithms:</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="leaky-bucket">Leaky Bucket<a href="#leaky-bucket" class="hash-link" aria-label="Leaky Bucket的直接链接" title="Leaky Bucket的直接链接">​</a></h4><p>Leaky Bucket is an algorithm that provides a simple, intuitive approach to rate limiting via a queue. When registering a request, the system appends it to the end of the queue. Processing for the first item on the queue occurs at a regular interval or first-in, first-out (FIFO). If the queue is full, then additional requests are discarded (or leaked).</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="token-bucket">Token Bucket<a href="#token-bucket" class="hash-link" aria-label="Token Bucket的直接链接" title="Token Bucket的直接链接">​</a></h4><p>Here we use a concept of a <em>bucket</em>. When a request comes in, a token from the bucket must be taken and processed. The request will be refused if no token is available in the bucket, and the requester will have to try again later. As a result, the token bucket gets refreshed after a certain time period.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="fixed-window">Fixed Window<a href="#fixed-window" class="hash-link" aria-label="Fixed Window的直接链接" title="Fixed Window的直接链接">​</a></h4><p>The system uses a window size of <code>n</code> seconds to track the fixed window algorithm rate. Each incoming request increments the counter for the window. It discards the request if the counter exceeds a threshold.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="sliding-log">Sliding Log<a href="#sliding-log" class="hash-link" aria-label="Sliding Log的直接链接" title="Sliding Log的直接链接">​</a></h4><p>Sliding Log rate-limiting involves tracking a time-stamped log for each request. The system stores these logs in a time-sorted hash set or table. It also discards logs with timestamps beyond a threshold. When a new request comes in, we calculate the sum of logs to determine the request rate. If the request would exceed the threshold rate, then it is held.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="sliding-window">Sliding Window<a href="#sliding-window" class="hash-link" aria-label="Sliding Window的直接链接" title="Sliding Window的直接链接">​</a></h4><p>Sliding Window is a hybrid approach that combines the fixed window algorithm&#x27;s low processing cost and the sliding log&#x27;s improved boundary conditions. Like the fixed window algorithm, we track a counter for each fixed window. Next, we account for a weighted value of the previous window&#x27;s request rate based on the current timestamp to smooth out bursts of traffic.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="rate-limiting-in-distributed-systems">Rate Limiting in Distributed Systems<a href="#rate-limiting-in-distributed-systems" class="hash-link" aria-label="Rate Limiting in Distributed Systems的直接链接" title="Rate Limiting in Distributed Systems的直接链接">​</a></h3><p>Rate Limiting becomes complicated when distributed systems are involved. The two broad problems that come with rate limiting in distributed systems are:</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="inconsistencies">Inconsistencies<a href="#inconsistencies" class="hash-link" aria-label="Inconsistencies的直接链接" title="Inconsistencies的直接链接">​</a></h4><p>When using a cluster of multiple nodes, we might need to enforce a global rate limit policy. Because if each node were to track its rate limit, a consumer could exceed a global rate limit when sending requests to different nodes. The greater the number of nodes, the more likely the user will exceed the global limit.</p><p>The simplest way to solve this problem is to use sticky sessions in our load balancers so that each consumer gets sent to exactly one node but this causes a lack of fault tolerance and scaling problems. Another approach might be to use a centralized data store like <a href="https://redis.io" target="_blank" rel="noopener noreferrer">Redis</a> but this will increase latency and cause race conditions.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="race-conditions">Race Conditions<a href="#race-conditions" class="hash-link" aria-label="Race Conditions的直接链接" title="Race Conditions的直接链接">​</a></h4><p>This issue happens when we use a naive <em>&quot;get-then-set&quot;</em> approach, in which we retrieve the current rate limit counter, increment it, and then push it back to the datastore. This model&#x27;s problem is that additional requests can come through in the time it takes to perform a full cycle of read-increment-store, each attempting to store the increment counter with an invalid (lower) counter value. This allows a consumer to send a very large number of requests to bypass the rate limiting controls.</p><p>One way to avoid this problem is to use some sort of distributed locking mechanism around the key, preventing any other processes from accessing or writing to the counter. Though the lock will become a significant bottleneck and will not scale well. A better approach might be to use a <em>&quot;set-then-get&quot;</em> approach, allowing us to quickly increment and check counter values without letting the atomic operations get in the way.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="service-discovery">Service Discovery<a href="#service-discovery" class="hash-link" aria-label="Service Discovery的直接链接" title="Service Discovery的直接链接">​</a></h2><p>Service discovery is the detection of services within a computer network. Service Discovery Protocol (SDP) is a networking standard that accomplishes the detection of networks by identifying resources.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="why-do-we-need-service-discovery">Why do we need Service Discovery?<a href="#why-do-we-need-service-discovery" class="hash-link" aria-label="Why do we need Service Discovery?的直接链接" title="Why do we need Service Discovery?的直接链接">​</a></h3><p>In a monolithic application, services invoke one another through language-level methods or procedure calls. However, modern microservices-based applications typically run in virtualized or containerized environments where the number of instances of a service and their locations change dynamically. Consequently, we need a mechanism that enables the clients of service to make requests to a dynamically changing set of ephemeral service instances.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="implementations">Implementations<a href="#implementations" class="hash-link" aria-label="Implementations的直接链接" title="Implementations的直接链接">​</a></h3><p>There are two main service discovery patterns:</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="client-side-discovery">Client-side discovery<a href="#client-side-discovery" class="hash-link" aria-label="Client-side discovery的直接链接" title="Client-side discovery的直接链接">​</a></h4><p><img loading="lazy" src="https://raw.githubusercontent.com/karanpratapsingh/portfolio/master/public/static/courses/system-design/chapter-IV/service-discovery/client-side-service-discovery.png" alt="client-side-service-discovery" class="img_ev3q"></p><p>In this approach, the client obtains the location of another service by querying a service registry which is responsible for managing and storing the network locations of all the services.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="server-side-discovery">Server-side discovery<a href="#server-side-discovery" class="hash-link" aria-label="Server-side discovery的直接链接" title="Server-side discovery的直接链接">​</a></h4><p><img loading="lazy" src="https://raw.githubusercontent.com/karanpratapsingh/portfolio/master/public/static/courses/system-design/chapter-IV/service-discovery/server-side-service-discovery.png" alt="server-side-service-discovery" class="img_ev3q"></p><p>In this approach, we use an intermediate component such as a load balancer. The client makes a request to the service via a load balancer which then forwards the request to an available service instance.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="service-registry">Service Registry<a href="#service-registry" class="hash-link" aria-label="Service Registry的直接链接" title="Service Registry的直接链接">​</a></h3><p>A service registry is basically a database containing the network locations of service instances to which the clients can reach out. A Service Registry must be highly available and up-to-date.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="service-registration">Service Registration<a href="#service-registration" class="hash-link" aria-label="Service Registration的直接链接" title="Service Registration的直接链接">​</a></h3><p>We also need a way to obtain service information, often known as service registration. Let&#x27;s look at two possible service registration approaches:</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="self-registration">Self-Registration<a href="#self-registration" class="hash-link" aria-label="Self-Registration的直接链接" title="Self-Registration的直接链接">​</a></h4><p>When using the self-registration model, a service instance is responsible for registering and de-registering itself in the Service Registry. In addition, if necessary, a service instance sends heartbeat requests to keep its registration alive.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="third-party-registration">Third-party Registration<a href="#third-party-registration" class="hash-link" aria-label="Third-party Registration的直接链接" title="Third-party Registration的直接链接">​</a></h4><p>The registry keeps track of changes to running instances by polling the deployment environment or subscribing to events. When it detects a newly available service instance, it records it in its database. The Service Registry also de-registers terminated service instances.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="service-mesh">Service mesh<a href="#service-mesh" class="hash-link" aria-label="Service mesh的直接链接" title="Service mesh的直接链接">​</a></h3><p>Service-to-service communication is essential in a distributed application but routing this communication, both within and across application clusters, becomes increasingly complex as the number of services grows. Service mesh enables managed, observable, and secure communication between individual services. It works with a service discovery protocol to detect services. <a href="https://istio.io/latest/about/service-mesh" target="_blank" rel="noopener noreferrer">Istio</a> and <a href="https://www.envoyproxy.io" target="_blank" rel="noopener noreferrer">envoy</a> are some of the most commonly used service mesh technologies.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="examples-1">Examples<a href="#examples-1" class="hash-link" aria-label="Examples的直接链接" title="Examples的直接链接">​</a></h3><p>Here are some commonly used service discovery infrastructure tools:</p><ul><li><a href="https://etcd.io" target="_blank" rel="noopener noreferrer">etcd</a></li><li><a href="https://www.consul.io" target="_blank" rel="noopener noreferrer">Consul</a></li><li><a href="https://thrift.apache.org" target="_blank" rel="noopener noreferrer">Apache Thrift</a></li><li><a href="https://zookeeper.apache.org" target="_blank" rel="noopener noreferrer">Apache Zookeeper</a></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="sla-slo-sli">SLA, SLO, SLI<a href="#sla-slo-sli" class="hash-link" aria-label="SLA, SLO, SLI的直接链接" title="SLA, SLO, SLI的直接链接">​</a></h2><p>Let&#x27;s briefly discuss SLA, SLO, and SLI. These are mostly related to the business and site reliability side of things but good to know nonetheless.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="why-are-they-important">Why are they important?<a href="#why-are-they-important" class="hash-link" aria-label="Why are they important?的直接链接" title="Why are they important?的直接链接">​</a></h3><p>SLAs, SLOs, and SLIs allow companies to define, track and monitor the promises made for a service to its users. Together, SLAs, SLOs, and SLIs should help teams generate more user trust in their services with an added emphasis on continuous improvement to incident management and response processes.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="sla">SLA<a href="#sla" class="hash-link" aria-label="SLA的直接链接" title="SLA的直接链接">​</a></h3><p>An SLA, or Service Level Agreement, is an agreement made between a company and its users of a given service. The SLA defines the different promises that the company makes to users regarding specific metrics, such as service availability.</p><p><em>SLAs are often written by a company&#x27;s business or legal team.</em></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="slo">SLO<a href="#slo" class="hash-link" aria-label="SLO的直接链接" title="SLO的直接链接">​</a></h3><p>An SLO, or Service Level Objective, is the promise that a company makes to users regarding a specific metric such as incident response or uptime. SLOs exist within an SLA as individual promises contained within the full user agreement. The SLO is the specific goal that the service must meet in order to comply with the SLA. SLOs should always be simple, clearly defined, and easily measured to determine whether or not the objective is being fulfilled.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="sli">SLI<a href="#sli" class="hash-link" aria-label="SLI的直接链接" title="SLI的直接链接">​</a></h3><p>An SLI, or Service Level Indicator, is a key metric used to determine whether or not the SLO is being met. It is the measured value of the metric described within the SLO. In order to remain in compliance with the SLA, the SLI&#x27;s value must always meet or exceed the value determined by the SLO.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="disaster-recovery">Disaster recovery<a href="#disaster-recovery" class="hash-link" aria-label="Disaster recovery的直接链接" title="Disaster recovery的直接链接">​</a></h2><p>Disaster recovery (DR) is a process of regaining access and functionality of the infrastructure after events like a natural disaster, cyber attack, or even business disruptions.</p><p>Disaster recovery relies upon the replication of data and computer processing in an off-premises location not affected by the disaster. When servers go down because of a disaster, a business needs to recover lost data from a second location where the data is backed up. Ideally, an organization can transfer its computer processing to that remote location as well in order to continue operations.</p><p><em>Disaster Recovery is often not actively discussed during system design interviews but it&#x27;s important to have some basic understanding of this topic. You can learn more about disaster recovery from <a href="https://docs.aws.amazon.com/wellarchitected/latest/reliability-pillar/plan-for-disaster-recovery-dr.html" target="_blank" rel="noopener noreferrer">AWS Well-Architected Framework</a>.</em></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="why-is-disaster-recovery-important">Why is disaster recovery important?<a href="#why-is-disaster-recovery-important" class="hash-link" aria-label="Why is disaster recovery important?的直接链接" title="Why is disaster recovery important?的直接链接">​</a></h3><p>Disaster recovery can have the following benefits:</p><ul><li>Minimize interruption and downtime</li><li>Limit damages</li><li>Fast restoration</li><li>Better customer retention</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="terms">Terms<a href="#terms" class="hash-link" aria-label="Terms的直接链接" title="Terms的直接链接">​</a></h3><p>Let&#x27;s discuss some important terms relevantly for disaster recovery:</p><p><img loading="lazy" src="https://raw.githubusercontent.com/karanpratapsingh/portfolio/master/public/static/courses/system-design/chapter-IV/disaster-recovery/disaster-recovery.png" alt="disaster-recovery" class="img_ev3q"></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="rto">RTO<a href="#rto" class="hash-link" aria-label="RTO的直接链接" title="RTO的直接链接">​</a></h4><p>Recovery Time Objective (RTO) is the maximum acceptable delay between the interruption of service and restoration of service. This determines what is considered an acceptable time window when service is unavailable.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="rpo">RPO<a href="#rpo" class="hash-link" aria-label="RPO的直接链接" title="RPO的直接链接">​</a></h4><p>Recovery Point Objective (RPO) is the maximum acceptable amount of time since the last data recovery point. This determines what is considered an acceptable loss of data between the last recovery point and the interruption of service.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="strategies">Strategies<a href="#strategies" class="hash-link" aria-label="Strategies的直接链接" title="Strategies的直接链接">​</a></h3><p>A variety of disaster recovery (DR) strategies can be part of a disaster recovery plan.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="back-up">Back-up<a href="#back-up" class="hash-link" aria-label="Back-up的直接链接" title="Back-up的直接链接">​</a></h4><p>This is the simplest type of disaster recovery and involves storing data off-site or on a removable drive.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="cold-site">Cold Site<a href="#cold-site" class="hash-link" aria-label="Cold Site的直接链接" title="Cold Site的直接链接">​</a></h4><p>In this type of disaster recovery, an organization sets up basic infrastructure in a second site.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="hot-site">Hot site<a href="#hot-site" class="hash-link" aria-label="Hot site的直接链接" title="Hot site的直接链接">​</a></h4><p>A hot site maintains up-to-date copies of data at all times. Hot sites are time-consuming to set up and more expensive than cold sites, but they dramatically reduce downtime.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="virtual-machines-vms-and-containers">Virtual Machines (VMs) and Containers<a href="#virtual-machines-vms-and-containers" class="hash-link" aria-label="Virtual Machines (VMs) and Containers的直接链接" title="Virtual Machines (VMs) and Containers的直接链接">​</a></h2><p>Before we discuss virtualization vs containerization, let&#x27;s learn what are virtual machines (VMs) and Containers.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="virtual-machines-vm">Virtual Machines (VM)<a href="#virtual-machines-vm" class="hash-link" aria-label="Virtual Machines (VM)的直接链接" title="Virtual Machines (VM)的直接链接">​</a></h3><p>A Virtual Machine (VM) is a virtual environment that functions as a virtual computer system with its own CPU, memory, network interface, and storage, created on a physical hardware system. A software called a hypervisor separates the machine&#x27;s resources from the hardware and provisions them appropriately so they can be used by the VM.</p><p>VMs are isolated from the rest of the system, and multiple VMs can exist on a single piece of hardware, like a server. They can be moved between host servers depending on the demand or to use resources more efficiently.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="what-is-a-hypervisor">What is a Hypervisor?<a href="#what-is-a-hypervisor" class="hash-link" aria-label="What is a Hypervisor?的直接链接" title="What is a Hypervisor?的直接链接">​</a></h4><p>A Hypervisor sometimes called a Virtual Machine Monitor (VMM), isolates the operating system and resources from the virtual machines and enables the creation and management of those VMs. The hypervisor treats resources like CPU, memory, and storage as a pool of resources that can be easily reallocated between existing guests or new virtual machines.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="why-use-a-virtual-machine">Why use a Virtual Machine?<a href="#why-use-a-virtual-machine" class="hash-link" aria-label="Why use a Virtual Machine?的直接链接" title="Why use a Virtual Machine?的直接链接">​</a></h4><p>Server consolidation is a top reason to use VMs. Most operating system and application deployments only use a small amount of the physical resources available. By virtualizing our servers, we can place many virtual servers onto each physical server to improve hardware utilization. This keeps us from needing to purchase additional physical resources.</p><p>A VM provides an environment that is isolated from the rest of a system, so whatever is running inside a VM won&#x27;t interfere with anything else running on the host hardware. Because VMs are isolated, they are a good option for testing new applications or setting up a production environment. We can also run a single-purpose VM to support a specific use case.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="containers">Containers<a href="#containers" class="hash-link" aria-label="Containers的直接链接" title="Containers的直接链接">​</a></h3><p>A container is a standard unit of software that packages up code and all its dependencies such as specific versions of runtimes and libraries so that the application runs quickly and reliably from one computing environment to another. Containers offer a logical packaging mechanism in which applications can be abstracted from the environment in which they actually run. This decoupling allows container-based applications to be deployed easily and consistently, regardless of the target environment.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="why-do-we-need-containers">Why do we need containers?<a href="#why-do-we-need-containers" class="hash-link" aria-label="Why do we need containers?的直接链接" title="Why do we need containers?的直接链接">​</a></h4><p>Let&#x27;s discuss some advantages of using containers:</p><p><strong>Separation of responsibility</strong></p><p>Containerization provides a clear separation of responsibility, as developers focus on application logic and dependencies, while operations teams can focus on deployment and management.</p><p><strong>Workload portability</strong></p><p>Containers can run virtually anywhere, greatly easing development and deployment.</p><p><strong>Application isolation</strong></p><p>Containers virtualize CPU, memory, storage, and network resources at the operating system level, providing developers with a view of the OS logically isolated from other applications.</p><p><strong>Agile development</strong></p><p>Containers allow developers to move much more quickly by avoiding concerns about dependencies and environments.</p><p><strong>Efficient operations</strong></p><p>Containers are lightweight and allow us to use just the computing resources we need.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="virtualization-vs-containerization">Virtualization vs Containerization<a href="#virtualization-vs-containerization" class="hash-link" aria-label="Virtualization vs Containerization的直接链接" title="Virtualization vs Containerization的直接链接">​</a></h3><p><img loading="lazy" src="https://raw.githubusercontent.com/karanpratapsingh/portfolio/master/public/static/courses/system-design/chapter-IV/virtual-machines-and-containers/virtualization-vs-containerization.png" alt="virtualization-vs-containerization" class="img_ev3q"></p><p>In traditional virtualization, a hypervisor virtualizes physical hardware. The result is that each virtual machine contains a guest OS, a virtual copy of the hardware that the OS requires to run, and an application and its associated libraries and dependencies.</p><p>Instead of virtualizing the underlying hardware, containers virtualize the operating system so each container contains only the application and its dependencies making them much more lightweight than VMs. Containers also share the OS kernel and use a fraction of the memory VMs require.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="oauth-20-and-openid-connect-oidc">OAuth 2.0 and OpenID Connect (OIDC)<a href="#oauth-20-and-openid-connect-oidc" class="hash-link" aria-label="OAuth 2.0 and OpenID Connect (OIDC)的直接链接" title="OAuth 2.0 and OpenID Connect (OIDC)的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="oauth-20">OAuth 2.0<a href="#oauth-20" class="hash-link" aria-label="OAuth 2.0的直接链接" title="OAuth 2.0的直接链接">​</a></h3><p>OAuth 2.0, which stands for Open Authorization, is a standard designed to provide consented access to resources on behalf of the user, without ever sharing the user&#x27;s credentials. OAuth 2.0 is an authorization protocol and not an authentication protocol, it is designed primarily as a means of granting access to a set of resources, for example, remote APIs or user&#x27;s data.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="concepts">Concepts<a href="#concepts" class="hash-link" aria-label="Concepts的直接链接" title="Concepts的直接链接">​</a></h4><p>The OAuth 2.0 protocol defines the following entities:</p><ul><li><strong>Resource Owner</strong>: The user or system that owns the protected resources and can grant access to them.</li><li><strong>Client</strong>: The client is the system that requires access to the protected resources.</li><li><strong>Authorization Server</strong>: This server receives requests from the Client for Access Tokens and issues them upon successful authentication and consent by the Resource Owner.</li><li><strong>Resource Server</strong>: A server that protects the user&#x27;s resources and receives access requests from the Client. It accepts and validates an Access Token from the Client and returns the appropriate resources.</li><li><strong>Scopes</strong>: They are used to specify exactly the reason for which access to resources may be granted. Acceptable scope values, and which resources they relate to, are dependent on the Resource Server.</li><li><strong>Access Token</strong>: A piece of data that represents the authorization to access resources on behalf of the end-user.</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="how-does-oauth-20-work">How does OAuth 2.0 work?<a href="#how-does-oauth-20-work" class="hash-link" aria-label="How does OAuth 2.0 work?的直接链接" title="How does OAuth 2.0 work?的直接链接">​</a></h4><p>Let&#x27;s learn how OAuth 2.0 works:</p><p><img loading="lazy" src="https://raw.githubusercontent.com/karanpratapsingh/portfolio/master/public/static/courses/system-design/chapter-IV/oauth2-and-openid-connect/oauth2.png" alt="oauth2" class="img_ev3q"></p><ol><li>The client requests authorization from the Authorization Server, supplying the client id and secret as identification. It also provides the scopes and an endpoint URI to send the Access Token or the Authorization Code.</li><li>The Authorization Server authenticates the client and verifies that the requested scopes are permitted.</li><li>The resource owner interacts with the authorization server to grant access.</li><li>The Authorization Server redirects back to the client with either an Authorization Code or Access Token, depending on the grant type. A Refresh Token may also be returned.</li><li>With the Access Token, the client can request access to the resource from the Resource Server.</li></ol><h4 class="anchor anchorWithStickyNavbar_LWe7" id="disadvantages">Disadvantages<a href="#disadvantages" class="hash-link" aria-label="Disadvantages的直接链接" title="Disadvantages的直接链接">​</a></h4><p>Here are the most common disadvantages of OAuth 2.0:</p><ul><li>Lacks built-in security features.</li><li>No standard implementation.</li><li>No common set of scopes.</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="openid-connect">OpenID Connect<a href="#openid-connect" class="hash-link" aria-label="OpenID Connect的直接链接" title="OpenID Connect的直接链接">​</a></h3><p>OAuth 2.0 is designed only for <em>authorization</em>, for granting access to data and features from one application to another. OpenID Connect (OIDC) is a thin layer that sits on top of OAuth 2.0 that adds login and profile information about the person who is logged in.</p><p>When an Authorization Server supports OIDC, it is sometimes called an identity provider (IdP), since it provides information about the Resource Owner back to the Client. OpenID Connect is relatively new, resulting in lower adoption and industry implementation of best practices compared to OAuth.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="concepts-1">Concepts<a href="#concepts-1" class="hash-link" aria-label="Concepts的直接链接" title="Concepts的直接链接">​</a></h4><p>The OpenID Connect (OIDC) protocol defines the following entities:</p><ul><li><strong>Relying Party</strong>: The current application.</li><li><strong>OpenID Provider</strong>: This is essentially an intermediate service that provides a one-time code to the Relying Party.</li><li><strong>Token Endpoint</strong>: A web server that accepts the One-Time Code (OTC) and provides an access code that&#x27;s valid for an hour. The main difference between OIDC and OAuth 2.0 is that the token is provided using JSON Web Token (JWT).</li><li><strong>UserInfo Endpoint</strong>: The Relying Party communicates with this endpoint, providing a secure token and receiving information about the end-user</li></ul><p>Both OAuth 2.0 and OIDC are easy to implement and are JSON based, which is supported by most web and mobile applications. However, the OpenID Connect (OIDC) specification is more strict than that of basic OAuth.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="single-sign-on-sso">Single Sign-On (SSO)<a href="#single-sign-on-sso" class="hash-link" aria-label="Single Sign-On (SSO)的直接链接" title="Single Sign-On (SSO)的直接链接">​</a></h2><p>Single Sign-On (SSO) is an authentication process in which a user is provided access to multiple applications or websites by using only a single set of login credentials. This prevents the need for the user to log separately into the different applications.</p><p>The user credentials and other identifying information are stored and managed by a centralized system called Identity Provider (IdP). The Identity Provider is a trusted system that provides access to other websites and applications.</p><p>Single Sign-On (SSO) based authentication systems are commonly used in enterprise environments where employees require access to multiple applications of their organizations.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="components">Components<a href="#components" class="hash-link" aria-label="Components的直接链接" title="Components的直接链接">​</a></h3><p>Let&#x27;s discuss some key components of Single Sign-On (SSO).</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="identity-provider-idp">Identity Provider (IdP)<a href="#identity-provider-idp" class="hash-link" aria-label="Identity Provider (IdP)的直接链接" title="Identity Provider (IdP)的直接链接">​</a></h4><p>User Identity information is stored and managed by a centralized system called Identity Provider (IdP). The Identity Provider authenticates the user and provides access to the service provider.</p><p>The identity provider can directly authenticate the user by validating a username and password or by validating an assertion about the user&#x27;s identity as presented by a separate identity provider. The identity provider handles the management of user identities in order to free the service provider from this responsibility.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="service-provider">Service Provider<a href="#service-provider" class="hash-link" aria-label="Service Provider的直接链接" title="Service Provider的直接链接">​</a></h4><p>A service provider provides services to the end-user. They rely on identity providers to assert the identity of a user, and typically certain attributes about the user are managed by the identity provider. Service providers may also maintain a local account for the user along with attributes that are unique to their service.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="identity-broker">Identity Broker<a href="#identity-broker" class="hash-link" aria-label="Identity Broker的直接链接" title="Identity Broker的直接链接">​</a></h4><p>An identity broker acts as an intermediary that connects multiple service providers with various different identity providers. Using Identity Broker, we can perform single sign-on over any application without the hassle of the protocol it follows.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="saml">SAML<a href="#saml" class="hash-link" aria-label="SAML的直接链接" title="SAML的直接链接">​</a></h3><p>Security Assertion Markup Language is an open standard that allows clients to share security information about identity, authentication, and permission across different systems. SAML is implemented with the Extensible Markup Language (XML) standard for sharing data.</p><p>SAML specifically enables identity federation, making it possible for identity providers (IdPs) to seamlessly and securely pass authenticated identities and their attributes to service providers.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="how-does-sso-work">How does SSO work?<a href="#how-does-sso-work" class="hash-link" aria-label="How does SSO work?的直接链接" title="How does SSO work?的直接链接">​</a></h3><p>Now, let&#x27;s discuss how Single Sign-On works:</p><p><img loading="lazy" src="https://raw.githubusercontent.com/karanpratapsingh/portfolio/master/public/static/courses/system-design/chapter-IV/single-sign-on/sso.png" alt="sso" class="img_ev3q"></p><ol><li>The user requests a resource from their desired application.</li><li>The application redirects the user to the Identity Provider (IdP) for authentication.</li><li>The user signs in with their credentials (usually, username and password).</li><li>Identity Provider (IdP) sends a Single Sign-On response back to the client application.</li><li>The application grants access to the user.</li></ol><h3 class="anchor anchorWithStickyNavbar_LWe7" id="saml-vs-oauth-20-and-openid-connect-oidc">SAML vs OAuth 2.0 and OpenID Connect (OIDC)<a href="#saml-vs-oauth-20-and-openid-connect-oidc" class="hash-link" aria-label="SAML vs OAuth 2.0 and OpenID Connect (OIDC)的直接链接" title="SAML vs OAuth 2.0 and OpenID Connect (OIDC)的直接链接">​</a></h3><p>There are many differences between SAML, OAuth, and OIDC. SAML uses XML to pass messages, while OAuth and OIDC use JSON. OAuth provides a simpler experience, while SAML is geared towards enterprise security.</p><p>OAuth and OIDC use RESTful communication extensively, which is why mobile, and modern web applications find OAuth and OIDC a better experience for the user. SAML, on the other hand, drops a session cookie in a browser that allows a user to access certain web pages. This is great for short-lived workloads.</p><p>OIDC is developer-friendly and simpler to implement, which broadens the use cases for which it might be implemented. It can be implemented from scratch pretty fast, via freely available libraries in all common programming languages. SAML can be complex to install and maintain, which only enterprise-size companies can handle well.</p><p>OpenID Connect is essentially a layer on top of the OAuth framework. Therefore, it can offer a built-in layer of permission that asks a user to agree to what the service provider might access. Although SAML is also capable of allowing consent flow, it achieves this by hard-coding carried out by a developer and not as part of its protocol.</p><p><em>Both of these authentication protocols are good at what they do. As always, a lot depends on our specific use cases and target audience.</em></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="advantages">Advantages<a href="#advantages" class="hash-link" aria-label="Advantages的直接链接" title="Advantages的直接链接">​</a></h3><p>Following are the benefits of using Single Sign-On:</p><ul><li>Ease of use as users only need to remember one set of credentials.</li><li>Ease of access without having to go through a lengthy authorization process.</li><li>Enforced security and compliance to protect sensitive data.</li><li>Simplifying the management with reduced IT support cost and admin time.</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="disadvantages-1">Disadvantages<a href="#disadvantages-1" class="hash-link" aria-label="Disadvantages的直接链接" title="Disadvantages的直接链接">​</a></h3><p>Here are some disadvantages of Single Sign-On:</p><ul><li>Single Password Vulnerability, if the main SSO password gets compromised, all the supported applications get compromised.</li><li>The authentication process using Single Sign-On is slower than traditional authentication as every application has to request the SSO provider for verification.</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="examples-2">Examples<a href="#examples-2" class="hash-link" aria-label="Examples的直接链接" title="Examples的直接链接">​</a></h3><p>These are some commonly used Identity Providers (IdP):</p><ul><li><a href="https://www.okta.com" target="_blank" rel="noopener noreferrer">Okta</a></li><li><a href="https://cloud.google.com/architecture/identity/single-sign-on" target="_blank" rel="noopener noreferrer">Google</a></li><li><a href="https://auth0.com" target="_blank" rel="noopener noreferrer">Auth0</a></li><li><a href="https://www.onelogin.com" target="_blank" rel="noopener noreferrer">OneLogin</a></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="ssl-tls-mtls">SSL, TLS, mTLS<a href="#ssl-tls-mtls" class="hash-link" aria-label="SSL, TLS, mTLS的直接链接" title="SSL, TLS, mTLS的直接链接">​</a></h2><p>Let&#x27;s briefly discuss some important communication security protocols such as SSL, TLS, and mTLS. I would say that from a <em>&quot;big picture&quot;</em> system design perspective, this topic is not very important but still good to know about.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="ssl">SSL<a href="#ssl" class="hash-link" aria-label="SSL的直接链接" title="SSL的直接链接">​</a></h3><p>SSL stands for Secure Sockets Layer, and it refers to a protocol for encrypting and securing communications that take place on the internet. It was first developed in 1995 but since has been deprecated in favor of TLS (Transport Layer Security).</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="why-is-it-called-an-ssl-certificate-if-it-is-deprecated">Why is it called an SSL certificate if it is deprecated?<a href="#why-is-it-called-an-ssl-certificate-if-it-is-deprecated" class="hash-link" aria-label="Why is it called an SSL certificate if it is deprecated?的直接链接" title="Why is it called an SSL certificate if it is deprecated?的直接链接">​</a></h4><p>Most major certificate providers still refer to certificates as SSL certificates, which is why the naming convention persists.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="why-was-ssl-so-important">Why was SSL so important?<a href="#why-was-ssl-so-important" class="hash-link" aria-label="Why was SSL so important?的直接链接" title="Why was SSL so important?的直接链接">​</a></h4><p>Originally, data on the web was transmitted in plaintext that anyone could read if they intercepted the message. SSL was created to correct this problem and protect user privacy. By encrypting any data that goes between the user and a web server, SSL also stops certain kinds of cyber attacks by preventing attackers from tampering with data in transit.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="tls">TLS<a href="#tls" class="hash-link" aria-label="TLS的直接链接" title="TLS的直接链接">​</a></h3><p>Transport Layer Security, or TLS, is a widely adopted security protocol designed to facilitate privacy and data security for communications over the internet. TLS evolved from a previous encryption protocol called Secure Sockets Layer (SSL). A primary use case of TLS is encrypting the communication between web applications and servers.</p><p>There are three main components to what the TLS protocol accomplishes:</p><ul><li><strong>Encryption</strong>: hides the data being transferred from third parties.</li><li><strong>Authentication</strong>: ensures that the parties exchanging information are who they claim to be.</li><li><strong>Integrity</strong>: verifies that the data has not been forged or tampered with.</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="mtls">mTLS<a href="#mtls" class="hash-link" aria-label="mTLS的直接链接" title="mTLS的直接链接">​</a></h3><p>Mutual TLS, or mTLS, is a method for mutual authentication. mTLS ensures that the parties at each end of a network connection are who they claim to be by verifying that they both have the correct private key. The information within their respective TLS certificates provides additional verification.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="why-use-mtls">Why use mTLS?<a href="#why-use-mtls" class="hash-link" aria-label="Why use mTLS?的直接链接" title="Why use mTLS?的直接链接">​</a></h4><p>mTLS helps ensure that the traffic is secure and trusted in both directions between a client and server. This provides an additional layer of security for users who log in to an organization&#x27;s network or applications. It also verifies connections with client devices that do not follow a login process, such as Internet of Things (IoT) devices.</p><p>Nowadays, mTLS is commonly used by microservices or distributed systems in a <a href="https://en.wikipedia.org/wiki/Zero_trust_security_model" target="_blank" rel="noopener noreferrer">zero trust security model</a> to verify each other.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/imwito/imwito.github.io/tree/main/docs/system-design/chapter4.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>编辑此页</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="文件选项卡"><a class="pagination-nav__link pagination-nav__link--prev" href="/zh-Hans/docs/system-design/chapter3"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">Chapter 3</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/zh-Hans/docs/system-design/chapter5"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">Chapter 5</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#geohashing-and-quadtrees" class="table-of-contents__link toc-highlight">Geohashing and Quadtrees</a><ul><li><a href="#geohashing" class="table-of-contents__link toc-highlight">Geohashing</a></li><li><a href="#quadtrees" class="table-of-contents__link toc-highlight">Quadtrees</a></li></ul></li><li><a href="#circuit-breaker" class="table-of-contents__link toc-highlight">Circuit breaker</a><ul><li><a href="#why-do-we-need-circuit-breaking" class="table-of-contents__link toc-highlight">Why do we need circuit breaking?</a></li><li><a href="#states" class="table-of-contents__link toc-highlight">States</a></li></ul></li><li><a href="#rate-limiting" class="table-of-contents__link toc-highlight">Rate Limiting</a><ul><li><a href="#why-do-we-need-rate-limiting" class="table-of-contents__link toc-highlight">Why do we need Rate Limiting?</a></li><li><a href="#algorithms" class="table-of-contents__link toc-highlight">Algorithms</a></li><li><a href="#rate-limiting-in-distributed-systems" class="table-of-contents__link toc-highlight">Rate Limiting in Distributed Systems</a></li></ul></li><li><a href="#service-discovery" class="table-of-contents__link toc-highlight">Service Discovery</a><ul><li><a href="#why-do-we-need-service-discovery" class="table-of-contents__link toc-highlight">Why do we need Service Discovery?</a></li><li><a href="#implementations" class="table-of-contents__link toc-highlight">Implementations</a></li><li><a href="#service-registry" class="table-of-contents__link toc-highlight">Service Registry</a></li><li><a href="#service-registration" class="table-of-contents__link toc-highlight">Service Registration</a></li><li><a href="#service-mesh" class="table-of-contents__link toc-highlight">Service mesh</a></li><li><a href="#examples-1" class="table-of-contents__link toc-highlight">Examples</a></li></ul></li><li><a href="#sla-slo-sli" class="table-of-contents__link toc-highlight">SLA, SLO, SLI</a><ul><li><a href="#why-are-they-important" class="table-of-contents__link toc-highlight">Why are they important?</a></li><li><a href="#sla" class="table-of-contents__link toc-highlight">SLA</a></li><li><a href="#slo" class="table-of-contents__link toc-highlight">SLO</a></li><li><a href="#sli" class="table-of-contents__link toc-highlight">SLI</a></li></ul></li><li><a href="#disaster-recovery" class="table-of-contents__link toc-highlight">Disaster recovery</a><ul><li><a href="#why-is-disaster-recovery-important" class="table-of-contents__link toc-highlight">Why is disaster recovery important?</a></li><li><a href="#terms" class="table-of-contents__link toc-highlight">Terms</a></li><li><a href="#strategies" class="table-of-contents__link toc-highlight">Strategies</a></li></ul></li><li><a href="#virtual-machines-vms-and-containers" class="table-of-contents__link toc-highlight">Virtual Machines (VMs) and Containers</a><ul><li><a href="#virtual-machines-vm" class="table-of-contents__link toc-highlight">Virtual Machines (VM)</a></li><li><a href="#containers" class="table-of-contents__link toc-highlight">Containers</a></li><li><a href="#virtualization-vs-containerization" class="table-of-contents__link toc-highlight">Virtualization vs Containerization</a></li></ul></li><li><a href="#oauth-20-and-openid-connect-oidc" class="table-of-contents__link toc-highlight">OAuth 2.0 and OpenID Connect (OIDC)</a><ul><li><a href="#oauth-20" class="table-of-contents__link toc-highlight">OAuth 2.0</a></li><li><a href="#openid-connect" class="table-of-contents__link toc-highlight">OpenID Connect</a></li></ul></li><li><a href="#single-sign-on-sso" class="table-of-contents__link toc-highlight">Single Sign-On (SSO)</a><ul><li><a href="#components" class="table-of-contents__link toc-highlight">Components</a></li><li><a href="#saml" class="table-of-contents__link toc-highlight">SAML</a></li><li><a href="#how-does-sso-work" class="table-of-contents__link toc-highlight">How does SSO work?</a></li><li><a href="#saml-vs-oauth-20-and-openid-connect-oidc" class="table-of-contents__link toc-highlight">SAML vs OAuth 2.0 and OpenID Connect (OIDC)</a></li><li><a href="#advantages" class="table-of-contents__link toc-highlight">Advantages</a></li><li><a href="#disadvantages-1" class="table-of-contents__link toc-highlight">Disadvantages</a></li><li><a href="#examples-2" class="table-of-contents__link toc-highlight">Examples</a></li></ul></li><li><a href="#ssl-tls-mtls" class="table-of-contents__link toc-highlight">SSL, TLS, mTLS</a><ul><li><a href="#ssl" class="table-of-contents__link toc-highlight">SSL</a></li><li><a href="#tls" class="table-of-contents__link toc-highlight">TLS</a></li><li><a href="#mtls" class="table-of-contents__link toc-highlight">mTLS</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 imwito, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/zh-Hans/assets/js/runtime~main.c214fdea.js"></script>
<script src="/zh-Hans/assets/js/main.c22237af.js"></script>
</body>
</html>